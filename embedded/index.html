<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <title>Content Security Policy: Embedded Enforcement</title>
<style data-fill-with="stylesheet">/******************************************************************************
 *                   Style sheet for the W3C specifications                   *
 *
 * Special classes handled by this style sheet include:
 *
 * Indices
 *   - .toc for the Table of Contents (<ol class="toc">)
 *     + <span class="secno"> for the section numbers
 *   - #toc for the Table of Contents (<nav id="toc">)
 *   - ul.index for Indices (<a href="#ref">term</a><span>, in Â§N.M</span>)
 *   - table.index for Index Tables (e.g. for properties or elements)
 *
 * Structural Markup
 *   - table.data for general data tables
 *     -> use 'scope' attribute, <colgroup>, <thead>, and <tbody> for best results !
 *     -> use <table class='complex data'> for extra-complex tables
 *     -> use <td class='long'> for paragraph-length cell content
 *     -> use <td class='pre'> when manual line breaks/indentation would help readability
 *   - dl.switch for switch statements
 *   - ol.algorithm for algorithms (helps to visualize nesting)
 *   - .figure and .caption (HTML4) and figure and figcaption (HTML5)
 *     -> .sidefigure for right-floated figures
 *   - ins/del
 *
 * Code
 *   - pre and code
 *
 * Special Sections
 *   - .note       for informative notes             (div, p, span, aside, details)
 *   - .example    for informative examples          (div, p, pre, span)
 *   - .issue      for issues                        (div, p, span)
 *   - .assertion  for assertions                    (div, p, span)
 *   - .advisement for loud normative statements     (div, p, strong)
 *   - .annoying-warning for spec obsoletion notices (div, aside, details)
 *
 * Definition Boxes
 *   - pre.def   for WebIDL definitions
 *   - table.def for tables that define other entities (e.g. CSS properties)
 *   - dl.def    for definition lists that define other entitles (e.g. HTML elements)
 *
 * Numbering
 *   - .secno for section numbers in .toc and headings (<span class='secno'>3.2</span>)
 *   - .marker for source-inserted example/figure/issue numbers (<span class='marker'>Issue 4</span>)
 *   - ::before styled for CSS-generated issue/example/figure numbers:
 *     -> Documents wishing to use this only need to add
 *        figcaption::before,
 *        .caption::before { content: "Figure "  counter(figure) " ";  }
 *        .example::before { content: "Example " counter(example) " "; }
 *        .issue::before   { content: "Issue "   counter(issue) " ";   }
 *
 * Header Stuff (ignore, just don't conflict with these classes)
 *   - .head for the header
 *   - .copyright for the copyright
 *
 * Miscellaneous
 *   - .overlarge for things that should be as wide as possible, even if
 *     that overflows the body text area. This can be used on an item or
 *     on its container, depending on the effect desired.
 *     Note that this styling basically doesn't help at all when printing,
 *     since A4 paper isn't much wider than the max-width here.
 *     It's better to design things to fit into a narrower measure if possible.
 *   - js-added ToC jump links (see fixup.js)
 *
 ******************************************************************************/

/******************************************************************************/
/*                                   Body                                     */
/******************************************************************************/

	body {
		counter-reset: example figure issue;

		/* Layout */
		max-width: 50em;               /* limit line length to 50em for readability   */
		margin: 0 auto;                /* center text within page                     */
		padding: 1.6em 1.5em 2em 50px; /* assume 16px font size for downlevel clients */
		padding: 1.6em 1.5em 2em calc(26px + 1.5em); /* leave space for status flag     */

		/* Typography */
		line-height: 1.5;
		font-family: sans-serif;
		widows: 2;
		orphans: 2;
		word-wrap: break-word;
		overflow-wrap: break-word;
		hyphens: auto;

		/* Colors */
		color: black;
		background: white top left fixed no-repeat;
		background-size: 25px auto;
	}


/******************************************************************************/
/*                         Front Matter & Navigation                          */
/******************************************************************************/

/** Header ********************************************************************/

	div.head { margin-bottom: 1em }
	div.head hr { border-style: solid; }

	div.head h1 {
		font-weight: bold;
		margin: 0 0 .1em;
		font-size: 220%;
	}

	div.head h2 { margin-bottom: 1.5em;}

/** W3C Logo ******************************************************************/

	.head .logo {
		float: right;
		margin: 0.4rem 0 0.2rem .4rem;
	}

	.head img[src*="logos/W3C"] {
		display: block;
		border: solid #1a5e9a;
		border-width: .65rem .7rem .6rem;
		border-radius: .4rem;
		background: #1a5e9a;
		color: white;
		font-weight: bold;
	}

	.head a:hover > img[src*="logos/W3C"],
	.head a:focus > img[src*="logos/W3C"] {
		opacity: .8;
	}

	.head a:active > img[src*="logos/W3C"] {
		background: #c00;
		border-color: #c00;
	}

	/* see also additional rules in Link Styling section */

/** Copyright *****************************************************************/

	p.copyright,
	p.copyright small { font-size: small }

/** Back to Top / ToC Toggle **************************************************/

	@media print {
		#toc-nav {
			display: none;
		}
	}
	@media not print {
		#toc-nav {
			position: fixed;
			z-index: 2;
			bottom: 0; left: 0;
			margin: 0;
			min-width: 1.33em;
			border-top-right-radius: 2rem;
			box-shadow: 0 0 2px;
			font-size: 1.5em;
			color: black;
		}
		#toc-nav > a {
			display: block;
			white-space: nowrap;

			height: 1.33em;
			padding: .1em 0.3em;
			margin: 0;

			background: white;
			box-shadow: 0 0 2px;
			border: none;
			border-top-right-radius: 1.33em;
			background: white;
		}
		#toc-nav > #toc-jump {
			padding-bottom: 2em;
			margin-bottom: -1.9em;
		}

		#toc-nav > a:hover,
		#toc-nav > a:focus {
			background: #f8f8f8;
		}
		#toc-nav > a:not(:hover):not(:focus) {
			color: #707070;
		}

		/* statusbar gets in the way on keyboard focus; remove once browsers fix */
		#toc-nav > a[href="#toc"]:not(:hover):focus:last-child {
			padding-bottom: 1.5rem;
		}

		#toc-nav:not(:hover) > a:not(:focus) > span + span {
			/* Ideally this uses :focus-within on #toc-nav */
			display: none;
		}
		#toc-nav > a > span + span {
			padding-right: 0.2em;
		}

		#toc-toggle-inline {
			vertical-align: 0.05em;
			font-size: 80%;
			color: gray;
			color: hsla(203,20%,40%,.7);
			border-style: none;
			background: transparent;
			position: relative;
		}
		#toc-toggle-inline:hover:not(:active),
		#toc-toggle-inline:focus:not(:active) {
			text-shadow: 1px 1px silver;
			top: -1px;
			left: -1px;
		}

		#toc-nav :active {
			color: #C00;
		}
	}

/** ToC Sidebar ***************************************************************/

	/* Floating sidebar */
	@media screen {
		body.toc-sidebar #toc {
			position: fixed;
			top: 0; bottom: 0;
			left: 0;
			width: 23.5em;
			max-width: 80%;
			max-width: calc(100% - 2em - 26px);
			overflow: auto;
			padding: 0 1em;
			padding-left: 42px;
			padding-left: calc(1em + 26px);
			background: inherit;
			background-color: #f7f8f9;
			z-index: 1;
			box-shadow: -.1em 0 .25em rgba(0,0,0,.1) inset;
		}
		body.toc-sidebar #toc h2 {
			margin-top: .8rem;
			font-variant: small-caps;
			font-variant: all-small-caps;
			text-transform: lowercase;
			font-weight: bold;
			color: gray;
			color: hsla(203,20%,40%,.7);
		}
		body.toc-sidebar #toc-jump:not(:focus) {
			width: 0;
			height: 0;
			padding: 0;
			position: absolute;
			overflow: hidden;
		}
	}
	/* Hide main scroller when only the ToC is visible anyway */
	@media screen and (max-width: 28em) {
		body.toc-sidebar {
			overflow: hidden;
		}
	}

	/* Sidebar with its own space */
	@media screen and (min-width: 78em) {
		body:not(.toc-inline) #toc {
			position: fixed;
			top: 0; bottom: 0;
			left: 0;
			width: 23.5em;
			overflow: auto;
			padding: 0 1em;
			padding-left: 42px;
			padding-left: calc(1em + 26px);
			background: inherit;
			background-color: #f7f8f9;
			z-index: 1;
			box-shadow: -.1em 0 .25em rgba(0,0,0,.1) inset;
		}
		body:not(.toc-inline) #toc h2 {
			margin-top: .8rem;
			font-variant: small-caps;
			font-variant: all-small-caps;
			text-transform: lowercase;
			font-weight: bold;
			color: gray;
			color: hsla(203,20%,40%,.7);
		}

		body:not(.toc-inline) {
			padding-left: 29em;
		}
		/* See also Overflow section at the bottom */

		body:not(.toc-inline) #toc-jump:not(:focus) {
			width: 0;
			height: 0;
			padding: 0;
			position: absolute;
			overflow: hidden;
		}
	}
	@media screen and (min-width: 90em) {
		body:not(.toc-inline) {
			margin: 0 4em;
		}
	}

/******************************************************************************/
/*                                Sectioning                                  */
/******************************************************************************/

/** Headings ******************************************************************/

	h1, h2, h3, h4, h5, h6, dt {
		page-break-after: avoid;
		page-break-inside: avoid;
		font: 100% sans-serif;   /* Reset all font styling to clear out UA styles */
		font-family: inherit;    /* Inherit the font family. */
		line-height: 1.2;        /* Keep wrapped headings compact */
		hyphens: manual;         /* Hyphenated headings look weird */
	}

	h2, h3, h4, h5, h6 {
		margin-top: 3rem;
	}

	h1, h2, h3 {
		color: #005A9C;
		background: transparent;
	}

	h1 { font-size: 170%; }
	h2 { font-size: 140%; }
	h3 { font-size: 120%; }
	h4 { font-weight: bold; }
	h5 { font-style: italic; }
	h6 { font-variant: small-caps; }
	dt { font-weight: bold; }

/** Subheadings ***************************************************************/

	h1 + h2,
	#subtitle {
		/* #subtitle is a subtitle in an H2 under the H1 */
		margin-top: 0;
	}
	h2 + h3,
	h3 + h4,
	h4 + h5,
	h5 + h6 {
		margin-top: 1.2em; /* = 1 x line-height */
	}

/** Section divider ***********************************************************/

	:not(.head) > hr {
		font-size: 1.5em;
		text-align: center;
		margin: 1em auto;
		height: auto;
		border: transparent solid 0;
		background: transparent;
	}
	:not(.head) > hr::before {
		content: "\2727\2003\2003\2727\2003\2003\2727";
	}

/******************************************************************************/
/*                            Paragraphs and Lists                            */
/******************************************************************************/

	p {
		margin: 1em 0;
	}

	dd > p:first-child,
	li > p:first-child {
		margin-top: 0;
	}

	ul, ol {
		margin-left: 0;
		padding-left: 2em;
	}

	li {
		margin: 0.25em 0 0.5em;
		padding: 0;
	}

	dl dd {
		margin: 0 0 .5em 2em;
	}

	.head dd + dd { /* compact for header */
		margin-top: -.5em;
	}

	/* Style for algorithms */
	ol.algorithm ol:not(.algorithm),
	.algorithm > ol ol:not(.algorithm) {
	 border-left: 0.5em solid #DEF;
	}

	/* Put nice boxes around each algorithm. */
	[data-algorithm]:not(.heading) {
	  padding: .5em;
	  border: thin solid #ddd; border-radius: .5em;
	  margin: .5em calc(-0.5em - 1px);
	}
	[data-algorithm]:not(.heading) > :first-child {
	  margin-top: 0;
	}
	[data-algorithm]:not(.heading) > :last-child {
	  margin-bottom: 0;
	}

	/* Style for switch/case <dl>s */
	dl.switch > dd > ol.only,
	dl.switch > dd > .only > ol {
	 margin-left: 0;
	}
	dl.switch > dd > ol.algorithm,
	dl.switch > dd > .algorithm > ol {
	 margin-left: -2em;
	}
	dl.switch {
	 padding-left: 2em;
	}
	dl.switch > dt {
	 text-indent: -1.5em;
	 margin-top: 1em;
	}
	dl.switch > dt + dt {
	 margin-top: 0;
	}
	dl.switch > dt::before {
	 content: '\21AA';
	 padding: 0 0.5em 0 0;
	 display: inline-block;
	 width: 1em;
	 text-align: right;
	 line-height: 0.5em;
	}

/** Terminology Markup ********************************************************/


/******************************************************************************/
/*                                 Inline Markup                              */
/******************************************************************************/

/** Terminology Markup ********************************************************/
	dfn   { /* Defining instance */
		font-weight: bolder;
	}
	a > i { /* Instance of term */
		font-style: normal;
	}
	dt dfn code, code.idl {
		font-size: normal;
	}
	dfn var {
		font-style: normal;
	}

/** Change Marking ************************************************************/

	del { color: red;  text-decoration: line-through; }
	ins { color: #080; text-decoration: underline;    }

/** Miscellaneous improvements to inline formatting ***************************/

	sup {
		vertical-align: super;
		font-size: 80%
	}

/******************************************************************************/
/*                                    Code                                    */
/******************************************************************************/

/** General monospace/pre rules ***********************************************/

	pre, code, samp {
		font-family: Menlo, Consolas, "DejaVu Sans Mono", Monaco, monospace;
		font-size: .9em;
		page-break-inside: avoid;
		hyphens: none;
		text-transform: none;
	}
	pre code,
	code code {
		font-size: 100%;
	}

	pre {
		margin-top: 1em;
		margin-bottom: 1em;
		overflow: auto;
	}

/** Inline Code fragments *****************************************************/

  /* Do something nice. */

/******************************************************************************/
/*                                    Links                                   */
/******************************************************************************/

/** General Hyperlinks ********************************************************/

	/* We hyperlink a lot, so make it less intrusive */
	a[href] {
		color: #034575;
		text-decoration: none;
		border-bottom: 1px solid #707070;
		/* Need a bit of extending for it to look okay */
		padding: 0 1px 0;
		margin: 0 -1px 0;
	}
	a:visited {
		border-bottom-color: #BBB;
	}

	/* Use distinguishing colors when user is interacting with the link */
	a[href]:focus,
	a[href]:hover {
		background: #f8f8f8;
		background: rgba(75%, 75%, 75%, .25);
		border-bottom-width: 3px;
		margin-bottom: -2px;
	}
	a[href]:active {
		color: #C00;
		border-color: #C00;
	}

	/* Backout above styling for W3C logo */
	.head .logo,
	.head .logo a {
		border: none;
		text-decoration: none;
		background: transparent;
	}

/******************************************************************************/
/*                                    Images                                  */
/******************************************************************************/

	img {
		border-style: none;
	}

	/* For autogen numbers, add
	   .caption::before, figcaption::before { content: "Figure " counter(figure) ". "; }
	*/

	figure, .figure, .sidefigure {
		page-break-inside: avoid;
		text-align: center;
		margin: 2.5em 0;
	}
	.figure img,    .sidefigure img,    figure img,
	.figure object, .sidefigure object, figure object {
		max-width: 100%;
		margin: auto;
	}
	.figure pre, .sidefigure pre, figure pre {
		text-align: left;
		display: table;
		margin: 1em auto;
	}
	.figure table, figure table {
		margin: auto;
	}
	@media screen and (min-width: 20em) {
		.sidefigure {
			float: right;
			width: 50%;
			margin: 0 0 0.5em 0.5em
		}
	}
	.caption, figcaption, caption {
		font-style: italic;
		font-size: 90%;
	}
	.caption::before, figcaption::before, figcaption > .marker {
		font-weight: bold;
	}
	.caption, figcaption {
		counter-increment: figure;
	}

	/* DL list is indented 2em, but figure inside it is not */
	dd > .figure, dd > figure { margin-left: -2em }

/******************************************************************************/
/*                             Colored Boxes                                  */
/******************************************************************************/

	.issue, .note, .example, .assertion, .advisement, blockquote {
		padding: .5em;
		border: .5em;
		border-left-style: solid;
		page-break-inside: avoid;
	}
	span.issue, span.note {
		padding: .1em .5em .15em;
		border-right-style: solid;
	}

	.issue,
	.note,
	.example,
	.advisement,
	.assertion,
	blockquote {
		margin: 1em auto;
	}
	.note  > p:first-child,
	.issue > p:first-child,
	blockquote > :first-child {
		margin-top: 0;
	}
	blockquote > :last-child {
		margin-bottom: 0;
	}

/** Blockquotes ***************************************************************/

	blockquote {
		border-color: silver;
	}

/** Open issue ****************************************************************/

	.issue {
		border-color: #E05252;
		background: #FBE9E9;
		counter-increment: issue;
		overflow: auto;
	}
	.issue::before, .issue > .marker {
		text-transform: uppercase;
		color: #AE1E1E;
		padding-right: 1em;
		text-transform: uppercase;
	}
	/* Add .issue::before { content: "Issue " counter(issue) " "; } for autogen numbers,
	   or use class="marker" to mark up the issue number in source. */

/** Example *******************************************************************/

	.example {
		border-color: #E0CB52;
		background: #FCFAEE;
		counter-increment: example;
		overflow: auto;
		clear: both;
	}
	.example::before, .example > .marker {
		text-transform: uppercase;
		color: #827017;
		min-width: 7.5em;
		display: block;
	}
	/* Add .example::before { content: "Example " counter(example) " "; } for autogen numbers,
	   or use class="marker" to mark up the example number in source. */

/** Non-normative Note ********************************************************/

	.note {
		border-color: #52E052;
		background: #E9FBE9;
		overflow: auto;
	}

	.note::before, .note > .marker,
	details.note > summary::before,
	details.note > summary > .marker {
		text-transform: uppercase;
		display: block;
		color: hsl(120, 70%, 30%);
	}
	/* Add .note::before { content: "Note"; } for autogen label,
	   or use class="marker" to mark up the label in source. */

	details.note > summary {
		display: block;
		color: hsl(120, 70%, 30%);
	}
	details.note[open] > summary {
		border-bottom: 1px silver solid;
	}

/** Assertion Box *************************************************************/
	/*  for assertions in algorithms */

	.assertion {
		border-color: #AAA;
		background: #EEE;
	}

/** Advisement Box ************************************************************/
	/*  for attention-grabbing normative statements */

	.advisement {
		border-color: orange;
		border-style: none solid;
		background: #FFEECC;
	}
	strong.advisement {
		display: block;
		text-align: center;
	}
	.advisement > .marker {
		color: #B35F00;
	}

/** Spec Obsoletion Notice ****************************************************/
	/* obnoxious obsoletion notice for older/abandoned specs. */

	details {
		display: block;
	}
	summary {
		font-weight: bolder;
	}

	.annoying-warning:not(details),
	details.annoying-warning:not([open]) > summary,
	details.annoying-warning[open] {
		background: #fdd;
		color: red;
		font-weight: bold;
		padding: .75em 1em;
		border: thick red;
		border-style: solid;
		border-radius: 1em;
	}
	.annoying-warning :last-child {
		margin-bottom: 0;
	}

@media not print {
	details.annoying-warning[open] {
		position: fixed;
		left: 1em;
		right: 1em;
		bottom: 1em;
		z-index: 1000;
	}
}

	details.annoying-warning:not([open]) > summary {
		text-align: center;
	}

/** Entity Definition Boxes ***************************************************/

	.def {
		padding: .5em 1em;
		background: #DEF;
		margin: 1.2em 0;
		border-left: 0.5em solid #8CCBF2;
	}

/******************************************************************************/
/*                                    Tables                                  */
/******************************************************************************/

	th, td {
		text-align: left;
		text-align: start;
	}

/** Property/Descriptor Definition Tables *************************************/

	table.def {
		/* inherits .def box styling, see above */
		width: 100%;
		border-spacing: 0;
	}

	table.def td,
	table.def th {
		padding: 0.5em;
		vertical-align: baseline;
		border-bottom: 1px solid #bbd7e9;
	}

	table.def > tbody > tr:last-child th,
	table.def > tbody > tr:last-child td {
		border-bottom: 0;
	}

	table.def th {
		font-style: italic;
		font-weight: normal;
		padding-left: 1em;
		width: 3em;
	}

	/* For when values are extra-complex and need formatting for readability */
	table td.pre {
		white-space: pre-wrap;
	}

	/* A footnote at the bottom of a def table */
	table.def           td.footnote {
		padding-top: 0.6em;
	}
	table.def           td.footnote::before {
		content: " ";
		display: block;
		height: 0.6em;
		width: 4em;
		border-top: thin solid;
	}

/** Data tables (and properly marked-up index tables) *************************/
	/*
		 <table class="data"> highlights structural relationships in a table
		 when correct markup is used (e.g. thead/tbody, th vs. td, scope attribute)

		 Use class="complex data" for particularly complicated tables --
		 (This will draw more lines: busier, but clearer.)

		 Use class="long" on table cells with paragraph-like contents
		 (This will adjust text alignment accordingly.)
		 Alternately use class="longlastcol" on tables, to have the last column assume "long".
	*/

	table {
		word-wrap: normal;
		overflow-wrap: normal;
		hyphens: manual;
	}

	table.data,
	table.index {
		margin: 1em auto;
		border-collapse: collapse;
		border: hidden;
		width: 100%;
	}
	table.data caption,
	table.index caption {
		max-width: 50em;
		margin: 0 auto 1em;
	}

	table.data td,  table.data th,
	table.index td, table.index th {
		padding: 0.5em 1em;
		border-width: 1px;
		border-color: silver;
		border-top-style: solid;
	}

	table.data thead td:empty {
		padding: 0;
		border: 0;
	}

	table.data  thead,
	table.index thead,
	table.data  tbody,
	table.index tbody {
		border-bottom: 2px solid;
	}

	table.data colgroup,
	table.index colgroup {
		border-left: 2px solid;
	}

	table.data  tbody th:first-child,
	table.index tbody th:first-child  {
		border-right: 2px solid;
		border-top: 1px solid silver;
		padding-right: 1em;
	}

	table.data th[colspan],
	table.data td[colspan] {
		text-align: center;
	}

	table.complex.data th,
	table.complex.data td {
		border: 1px solid silver;
		text-align: center;
	}

	table.data.longlastcol td:last-child,
	table.data td.long {
	 vertical-align: baseline;
	 text-align: left;
	}

	table.data img {
		vertical-align: middle;
	}


/*
Alternate table alignment rules

	table.data,
	table.index {
		text-align: center;
	}

	table.data  thead th[scope="row"],
	table.index thead th[scope="row"] {
		text-align: right;
	}

	table.data  tbody th:first-child,
	table.index tbody th:first-child  {
		text-align: right;
	}

Possible extra rowspan handling

	table.data  tbody th[rowspan]:not([rowspan='1']),
	table.index tbody th[rowspan]:not([rowspan='1']),
	table.data  tbody td[rowspan]:not([rowspan='1']),
	table.index tbody td[rowspan]:not([rowspan='1']) {
		border-left: 1px solid silver;
	}

	table.data  tbody th[rowspan]:first-child,
	table.index tbody th[rowspan]:first-child,
	table.data  tbody td[rowspan]:first-child,
	table.index tbody td[rowspan]:first-child{
		border-left: 0;
		border-right: 1px solid silver;
	}
*/

/******************************************************************************/
/*                                  Indices                                   */
/******************************************************************************/


/** Table of Contents *********************************************************/

	.toc a {
		/* More spacing; use padding to make it part of the click target. */
		padding-top: 0.1rem;
		/* Larger, more consistently-sized click target */
		display: block;
		/* Reverse color scheme */
		color: black;
		border-color: #3980B5;
		border-bottom-width: 3px !important;
		margin-bottom: 0px !important;
	}
	.toc a:visited {
		border-color: #054572;
	}
	.toc a:not(:focus):not(:hover) {
		/* Allow colors to cascade through from link styling */
		border-bottom-color: transparent;
	}

	.toc, .toc ol, .toc ul, .toc li {
		list-style: none; /* Numbers must be inlined into source */
		/* because generated content isn't search/selectable and markers can't do multilevel yet */
		margin:  0;
		padding: 0;
		line-height: 1.1rem; /* consistent spacing */
	}

	/* ToC not indented until third level, but font style & margins show hierarchy */
	.toc > li             { font-weight: bold;   }
	.toc > li li          { font-weight: normal; }
	.toc > li li li       { font-size:   95%;    }
	.toc > li li li li    { font-size:   90%;    }
	.toc > li li li li li { font-size:   85%;    }

	.toc > li             { margin: 1.5rem 0;    }
	.toc > li li          { margin: 0.3rem 0;    }
	.toc > li li li       { margin-left: 2rem;   }

	/* Section numbers in a column of their own */
	.toc .secno {
		float: left;
		width: 4rem;
		white-space: nowrap;
	}
	.toc > li li li li .secno {
		font-size: 85%;
	}
	.toc > li li li li li .secno {
		font-size: 100%;
	}

	:not(li) > .toc              { margin-left:  5rem; }
	.toc .secno                  { margin-left: -5rem; }
	.toc > li li li .secno       { margin-left: -7rem; }
	.toc > li li li li .secno    { margin-left: -9rem; }
	.toc > li li li li li .secno { margin-left: -11rem; }

	/* Tighten up indentation in narrow ToCs */
	@media (max-width: 30em) {
		:not(li) > .toc              { margin-left:  4rem; }
		.toc .secno                  { margin-left: -4rem; }
		.toc > li li li              { margin-left:  1rem; }
		.toc > li li li .secno       { margin-left: -5rem; }
		.toc > li li li li .secno    { margin-left: -6rem; }
		.toc > li li li li li .secno { margin-left: -7rem; }
	}
	@media screen and (min-width: 78em) {
		body:not(.toc-inline) :not(li) > .toc              { margin-left:  4rem; }
		body:not(.toc-inline) .toc .secno                  { margin-left: -4rem; }
		body:not(.toc-inline) .toc > li li li              { margin-left:  1rem; }
		body:not(.toc-inline) .toc > li li li .secno       { margin-left: -5rem; }
		body:not(.toc-inline) .toc > li li li li .secno    { margin-left: -6rem; }
		body:not(.toc-inline) .toc > li li li li li .secno { margin-left: -7rem; }
	}
	body.toc-sidebar #toc :not(li) > .toc              { margin-left:  4rem; }
	body.toc-sidebar #toc .toc .secno                  { margin-left: -4rem; }
	body.toc-sidebar #toc .toc > li li li              { margin-left:  1rem; }
	body.toc-sidebar #toc .toc > li li li .secno       { margin-left: -5rem; }
	body.toc-sidebar #toc .toc > li li li li .secno    { margin-left: -6rem; }
	body.toc-sidebar #toc .toc > li li li li li .secno { margin-left: -7rem; }

	.toc li {
		clear: both;
	}


/** Index *********************************************************************/

	/* Index Lists: Layout */
	ul.index       { margin-left: 0; columns: 15em; text-indent: 1em hanging; }
	ul.index li    { margin-left: 0; list-style: none; break-inside: avoid; }
	ul.index li li { margin-left: 1em }
	ul.index dl    { margin-top: 0; }
	ul.index dt    { margin: .2em 0 .2em 20px;}
	ul.index dd    { margin: .2em 0 .2em 40px;}
	/* Index Lists: Typography */
	ul.index ul,
	ul.index dl { font-size: smaller; }
	@media not print {
		ul.index li span {
			white-space: nowrap;
			color: transparent; }
		ul.index li a:hover + span,
		ul.index li a:focus + span {
			color: #707070;
		}
	}

/** Index Tables *****************************************************/
	/* See also the data table styling section, which this effectively subclasses */

	table.index {
		font-size: small;
		border-collapse: collapse;
		border-spacing: 0;
		text-align: left;
		margin: 1em 0;
	}

	table.index td,
	table.index th {
		padding: 0.4em;
	}

	table.index tr:hover td:not([rowspan]),
	table.index tr:hover th:not([rowspan]) {
		background: #f7f8f9;
	}

	/* The link in the first column in the property table (formerly a TD) */
	table.index th:first-child a {
		font-weight: bold;
	}

/******************************************************************************/
/*                                    Print                                   */
/******************************************************************************/

	@media print {
		/* Pages have their own margins. */
		html {
			margin: 0;
		}
		/* Serif for print. */
		body {
			font-family: serif;
		}
	}
	@page {
		margin: 1.5cm 1.1cm;
	}

/******************************************************************************/
/*                                    Legacy                                  */
/******************************************************************************/

	/* This rule is inherited from past style sheets. No idea what it's for. */
	.hide { display: none }



/******************************************************************************/
/*                             Overflow Control                               */
/******************************************************************************/

	.figure .caption, .sidefigure .caption, figcaption {
		/* in case figure is overlarge, limit caption to 50em */
		max-width: 50rem;
		margin-left: auto;
		margin-right: auto;
	}
	.overlarge > table {
		/* limit preferred width of table */
		max-width: 50em;
		margin-left: auto;
		margin-right: auto;
	}

	@media (min-width: 55em) {
		.overlarge {
			margin-left: calc(13px + 26.5rem - 50vw);
			margin-right: calc(13px + 26.5rem - 50vw);
			max-width: none;
		}
	}
	@media screen and (min-width: 78em) {
		body:not(.toc-inline) .overlarge {
			/* 30.5em body padding 50em content area */
			margin-left: calc(40em - 50vw) !important;
			margin-right: calc(40em - 50vw) !important;
		}
	}
	@media screen and (min-width: 90em) {
		body:not(.toc-inline) .overlarge {
			/* 4em html margin 30.5em body padding 50em content area */
			margin-left: 0 !important;
			margin-right: calc(84.5em - 100vw) !important;
		}
	}

	@media not print {
		.overlarge {
			overflow-x: auto;
			/* See Lea Verou's explanation background-attachment:
			 * http://lea.verou.me/2012/04/background-attachment-local/
			 *
			background: top left  / 4em 100% linear-gradient(to right,  #ffffff, rgba(255, 255, 255, 0)) local,
			            top right / 4em 100% linear-gradient(to left, #ffffff, rgba(255, 255, 255, 0)) local,
			            top left  / 1em 100% linear-gradient(to right,  #c3c3c5, rgba(195, 195, 197, 0)) scroll,
			            top right / 1em 100% linear-gradient(to left, #c3c3c5, rgba(195, 195, 197, 0)) scroll,
			            white;
			background-repeat: no-repeat;
			*/
		}
	}
</style>
  <meta content="Bikeshed version edf04655cdbbf30dd4c7dbad313044553232b75a" name="generator">
  <link href="https://www.w3.org/TR/csp-embedded-enforcement/" rel="canonical">
<style>/* style-md-lists */

            /* This is a weird hack for me not yet following the commonmark spec
               regarding paragraph and lists. */
            [data-md] > :first-child {
                margin-top: 0;
            }
            [data-md] > :last-child {
                margin-bottom: 0;
            }</style>
<style>/* style-selflinks */

            .heading, .issue, .note, .example, li, dt {
                position: relative;
            }
            a.self-link {
                position: absolute;
                top: 0;
                left: calc(-1 * (3.5rem - 26px));
                width: calc(3.5rem - 26px);
                height: 2em;
                text-align: center;
                border: none;
                transition: opacity .2s;
                opacity: .5;
            }
            a.self-link:hover {
                opacity: 1;
            }
            .heading > a.self-link {
                font-size: 83%;
            }
            li > a.self-link {
                left: calc(-1 * (3.5rem - 26px) - 2em);
            }
            dfn > a.self-link {
                top: auto;
                left: auto;
                opacity: 0;
                width: 1.5em;
                height: 1.5em;
                background: gray;
                color: white;
                font-style: normal;
                transition: opacity .2s, background-color .2s, color .2s;
            }
            dfn:hover > a.self-link {
                opacity: 1;
            }
            dfn > a.self-link:hover {
                color: black;
            }

            a.self-link::before            { content: "Â¶"; }
            .heading > a.self-link::before { content: "Â§"; }
            dfn > a.self-link::before      { content: "#"; }</style>
<style>/* style-counters */

            body {
                counter-reset: example figure issue;
            }
            .issue {
                counter-increment: issue;
            }
            .issue:not(.no-marker)::before {
                content: "Issue " counter(issue);
            }

            .example {
                counter-increment: example;
            }
            .example:not(.no-marker)::before {
                content: "Example " counter(example);
            }
            .invalid.example:not(.no-marker)::before,
            .illegal.example:not(.no-marker)::before {
                content: "Invalid Example" counter(example);
            }

            figcaption {
                counter-increment: figure;
            }
            figcaption:not(.no-marker)::before {
                content: "Figure " counter(figure) " ";
            }</style>
<style>/* style-autolinks */

            .css.css, .property.property, .descriptor.descriptor {
                color: #005a9c;
                font-size: inherit;
                font-family: inherit;
            }
            .css::before, .property::before, .descriptor::before {
                content: "â";
            }
            .css::after, .property::after, .descriptor::after {
                content: "â";
            }
            .property, .descriptor {
                /* Don't wrap property and descriptor names */
                white-space: nowrap;
            }
            .type { /* CSS value <type> */
                font-style: italic;
            }
            pre .property::before, pre .property::after {
                content: "";
            }
            [data-link-type="property"]::before,
            [data-link-type="propdesc"]::before,
            [data-link-type="descriptor"]::before,
            [data-link-type="value"]::before,
            [data-link-type="function"]::before,
            [data-link-type="at-rule"]::before,
            [data-link-type="selector"]::before,
            [data-link-type="maybe"]::before {
                content: "â";
            }
            [data-link-type="property"]::after,
            [data-link-type="propdesc"]::after,
            [data-link-type="descriptor"]::after,
            [data-link-type="value"]::after,
            [data-link-type="function"]::after,
            [data-link-type="at-rule"]::after,
            [data-link-type="selector"]::after,
            [data-link-type="maybe"]::after {
                content: "â";
            }

            [data-link-type].production::before,
            [data-link-type].production::after,
            .prod [data-link-type]::before,
            .prod [data-link-type]::after {
                content: "";
            }

            [data-link-type=element],
            [data-link-type=element-attr] {
                font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
                font-size: .9em;
            }
            [data-link-type=element]::before { content: "<" }
            [data-link-type=element]::after  { content: ">" }

            [data-link-type=biblio] {
                white-space: pre;
            }</style>
<style>/* style-dfn-panel */

        .dfn-panel {
            position: absolute;
            z-index: 35;
            height: auto;
            width: -webkit-fit-content;
            width: fit-content;
            max-width: 300px;
            max-height: 500px;
            overflow: auto;
            padding: 0.5em 0.75em;
            font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
            background: #DDDDDD;
            color: black;
            border: outset 0.2em;
        }
        .dfn-panel:not(.on) { display: none; }
        .dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
        .dfn-panel > b { display: block; }
        .dfn-panel a { color: black; }
        .dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
        .dfn-panel > b + b { margin-top: 0.25em; }
        .dfn-panel ul { padding: 0; }
        .dfn-panel li { list-style: inside; }
        .dfn-panel.activated {
            display: inline-block;
            position: fixed;
            left: .5em;
            bottom: 2em;
            margin: 0 auto;
            max-width: calc(100vw - 1.5em - .4em - .5em);
            max-height: 30vh;
        }

        .dfn-paneled { cursor: pointer; }
        </style>
<style>/* style-syntax-highlighting */
pre.idl.highlight { color: #708090; }
        .highlight:not(.idl) { background: hsl(24, 20%, 95%); }
        code.highlight { padding: .1em; border-radius: .3em; }
        pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }
        .highlight .c { color: #708090 } /* Comment */
        .highlight .k { color: #990055 } /* Keyword */
        .highlight .l { color: #000000 } /* Literal */
        .highlight .n { color: #0077aa } /* Name */
        .highlight .o { color: #999999 } /* Operator */
        .highlight .p { color: #999999 } /* Punctuation */
        .highlight .cm { color: #708090 } /* Comment.Multiline */
        .highlight .cp { color: #708090 } /* Comment.Preproc */
        .highlight .c1 { color: #708090 } /* Comment.Single */
        .highlight .cs { color: #708090 } /* Comment.Special */
        .highlight .kc { color: #990055 } /* Keyword.Constant */
        .highlight .kd { color: #990055 } /* Keyword.Declaration */
        .highlight .kn { color: #990055 } /* Keyword.Namespace */
        .highlight .kp { color: #990055 } /* Keyword.Pseudo */
        .highlight .kr { color: #990055 } /* Keyword.Reserved */
        .highlight .kt { color: #990055 } /* Keyword.Type */
        .highlight .ld { color: #000000 } /* Literal.Date */
        .highlight .m { color: #000000 } /* Literal.Number */
        .highlight .s { color: #a67f59 } /* Literal.String */
        .highlight .na { color: #0077aa } /* Name.Attribute */
        .highlight .nc { color: #0077aa } /* Name.Class */
        .highlight .no { color: #0077aa } /* Name.Constant */
        .highlight .nd { color: #0077aa } /* Name.Decorator */
        .highlight .ni { color: #0077aa } /* Name.Entity */
        .highlight .ne { color: #0077aa } /* Name.Exception */
        .highlight .nf { color: #0077aa } /* Name.Function */
        .highlight .nl { color: #0077aa } /* Name.Label */
        .highlight .nn { color: #0077aa } /* Name.Namespace */
        .highlight .py { color: #0077aa } /* Name.Property */
        .highlight .nt { color: #669900 } /* Name.Tag */
        .highlight .nv { color: #222222 } /* Name.Variable */
        .highlight .ow { color: #999999 } /* Operator.Word */
        .highlight .mb { color: #000000 } /* Literal.Number.Bin */
        .highlight .mf { color: #000000 } /* Literal.Number.Float */
        .highlight .mh { color: #000000 } /* Literal.Number.Hex */
        .highlight .mi { color: #000000 } /* Literal.Number.Integer */
        .highlight .mo { color: #000000 } /* Literal.Number.Oct */
        .highlight .sb { color: #a67f59 } /* Literal.String.Backtick */
        .highlight .sc { color: #a67f59 } /* Literal.String.Char */
        .highlight .sd { color: #a67f59 } /* Literal.String.Doc */
        .highlight .s2 { color: #a67f59 } /* Literal.String.Double */
        .highlight .se { color: #a67f59 } /* Literal.String.Escape */
        .highlight .sh { color: #a67f59 } /* Literal.String.Heredoc */
        .highlight .si { color: #a67f59 } /* Literal.String.Interpol */
        .highlight .sx { color: #a67f59 } /* Literal.String.Other */
        .highlight .sr { color: #a67f59 } /* Literal.String.Regex */
        .highlight .s1 { color: #a67f59 } /* Literal.String.Single */
        .highlight .ss { color: #a67f59 } /* Literal.String.Symbol */
        .highlight .vc { color: #0077aa } /* Name.Variable.Class */
        .highlight .vg { color: #0077aa } /* Name.Variable.Global */
        .highlight .vi { color: #0077aa } /* Name.Variable.Instance */
        .highlight .il { color: #000000 } /* Literal.Number.Integer.Long */
        </style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2016/logos/W3C" width="72"> </a> </p>
   <h1>Content Security Policy: Embedded Enforcement</h1>
   <h2 class="no-num no-toc no-ref heading settled" id="subtitle"><span class="content">Editorâs Draft, <time class="dt-updated" datetime="2017-05-30">30 May 2017</time></span></h2>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>This version:
     <dd><a class="u-url" href="https://w3c.github.io/webappsec-csp/embedded/">https://w3c.github.io/webappsec-csp/embedded/</a>
     <dt>Latest published version:
     <dd><a href="https://www.w3.org/TR/csp-embedded-enforcement/">https://www.w3.org/TR/csp-embedded-enforcement/</a>
     <dt>Previous Versions:
     <dd><a href="https://www.w3.org/TR/2015/WD-csp-embedded-enforcement-20160909/" rel="prev">https://www.w3.org/TR/2015/WD-csp-embedded-enforcement-20160909/</a>
     <dt>Version History:
     <dd><a href="https://github.com/w3c/webappsec-csp/commits/master/embedded/index.src.html">https://github.com/w3c/webappsec-csp/commits/master/embedded/index.src.html</a>
     <dt>Feedback:
     <dd><span><a href="mailto:public-webappsec@w3.org?subject=%5Bcsp-embedded-enforcement%5D%20YOUR%20TOPIC%20HERE">public-webappsec@w3.org</a> with subject line â<kbd>[csp-embedded-enforcement] <i data-lt="">â¦ message topic â¦</i></kbd>â (<a href="https://lists.w3.org/Archives/Public/public-webappsec/" rel="discussion">archives</a>)</span>
     <dt class="editor">Editor:
     <dd class="editor p-author h-card vcard" data-editor-id="56384"><a class="p-name fn u-email email" href="mailto:mkwst@google.com">Mike West</a> (<span class="p-org org">Google Inc.</span>)
     <dt>Participate:
     <dd><span><a href="https://github.com/w3c/webappsec-csp/issues/new">File an issue</a> (<a href="https://github.com/w3c/webappsec-csp/issues">open issues</a>)</span>
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="https://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> Â© 2017 <a href="https://www.w3.org/"><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>Â®</sup> (<a href="https://www.csail.mit.edu/"><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>, <a href="https://www.ercim.eu/"><abbr title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>, <a href="https://www.keio.ac.jp/">Keio</a>, <a href="http://ev.buaa.edu.cn/">Beihang</a>). W3C <a href="https://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>, <a href="https://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> and <a href="https://www.w3.org/Consortium/Legal/copyright-documents">document use</a> rules apply. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>This document defines a mechanism by which a web page can embed a nested

browsing context if and only if it agrees to enforce a particular set of
restrictions upon itself.</p>
  </div>
  <h2 class="no-num no-toc no-ref heading settled" id="status"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p> This is a public copy of the editorsâ draft.
	It is provided for discussion only and may change at any moment.
	Its publication here does not imply endorsement of its contents by W3C.
	Donât cite this document other than as work in progress. </p>
   <p> <strong>Changes to this document may be tracked at <a href="https://github.com/w3c/webappsec">https://github.com/w3c/webappsec</a>.</strong> </p>
   <p> The (<a href="https://lists.w3.org/Archives/Public/public-webappsec/">archived</a>) public mailing list <a href="mailto:public-webappsec@w3.org?Subject=%5Bcsp-embedded-enforcement%5D%20PUT%20SUBJECT%20HERE">public-webappsec@w3.org</a> (see <a href="https://www.w3.org/Mail/Request">instructions</a>)
	is preferred for discussion of this specification.
	When sending e-mail,
	please put the text âcsp-embedded-enforcementâ in the subject,
	preferably like this:
	â[csp-embedded-enforcement] <em>â¦summary of commentâ¦</em>â </p>
   <p> This document was produced by the <a href="https://www.w3.org/2011/webappsec/">Web Application Security Working Group</a>. </p>
   <p> This document was produced by a group operating under
	the <a href="https://www.w3.org/Consortium/Patent-Policy-20040205/">5 February 2004 W3C Patent Policy</a>.
	W3C maintains a <a href="https://www.w3.org/2004/01/pp-impl/49309/status" rel="disclosure">public list of any patent disclosures</a> made in connection with the deliverables of the group;
	that page also includes instructions for disclosing a patent.
	An individual who has actual knowledge of a patent which the individual believes contains <a href="https://www.w3.org/Consortium/Patent-Policy-20040205/#def-essential">Essential Claim(s)</a> must disclose the information in accordance with <a href="https://www.w3.org/Consortium/Patent-Policy-20040205/#sec-Disclosure">section 6 of the W3C Patent Policy</a>. </p>
   <p> This document is governed by the <a href="https://www.w3.org/2017/Process-20170301/" id="w3c_process_revision">1 March 2017 W3C Process Document</a>. </p>
   <p></p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li>
     <a href="#intro"><span class="secno">1</span> <span class="content">Introduction</span></a>
     <ol class="toc">
      <li><a href="#examples"><span class="secno">1.1</span> <span class="content">Examples</span></a>
     </ol>
    <li>
     <a href="#framework"><span class="secno">2</span> <span class="content">Framework</span></a>
     <ol class="toc">
      <li><a href="#csp-attribute"><span class="secno">2.1</span> <span class="content"><code>&lt;iframe></code>'s <code>csp</code> attribute</span></a>
      <li><a href="#required-csp-header"><span class="secno">2.2</span> <span class="content">The <code>Sec-Required-CSP</code> HTTP Request Header</span></a>
      <li><a href="#allow-csp-from-header"><span class="secno">2.3</span> <span class="content">The <code>Allow-CSP-From</code> HTTP Response Header</span></a>
      <li>
       <a href="#html-integration"><span class="secno">2.4</span> <span class="content">Integration with HTML</span></a>
       <ol class="toc">
        <li><a href="#required-csp"><span class="secno">2.4.1</span> <span class="content">Browsing Contextâs Required CSP</span></a>
       </ol>
     </ol>
    <li>
     <a href="#implicit-opt-in"><span class="secno">3</span> <span class="content">Implicit Policy Acceptance</span></a>
     <ol class="toc">
      <li>
       <a href="#intersection"><span class="secno">3.1</span> <span class="content">Intersection</span></a>
       <ol class="toc">
        <li><a href="#intersection-policy-list"><span class="secno">3.1.1</span> <span class="content">Policy List intersection</span></a>
        <li><a href="#intersection-policy"><span class="secno">3.1.2</span> <span class="content">Policy Intersection</span></a>
        <li><a href="#intersection-source-list"><span class="secno">3.1.3</span> <span class="content">Source List Intersection</span></a>
        <li>
         <a href="#intersection-helpers"><span class="secno">3.1.4</span> <span class="content">Intersection Helpers</span></a>
         <ol class="toc">
          <li><a href="#effective-directive"><span class="secno">3.1.4.1</span> <span class="content">Effective Directive Value</span></a>
          <li><a href="#the-effective-source-list"><span class="secno">3.1.4.2</span> <span class="content">Effective Source List</span></a>
          <li><a href="#similarity-source-expressions"><span class="secno">3.1.4.3</span> <span class="content">Source Expression Similarity</span></a>
         </ol>
       </ol>
      <li><a href="#subsumption"><span class="secno">3.2</span> <span class="content">Subsumption</span></a>
     </ol>
    <li>
     <a href="#algorithms"><span class="secno">4</span> <span class="content">Algorithms</span></a>
     <ol class="toc">
      <li><a href="#process-response"><span class="secno">4.1</span> <span class="content"> Is <var>response</var> to <var>request</var> blocked by <var>context</var>âs required CSP? </span></a>
      <li>
       <a href="#origin-allowed"><span class="secno">4.2</span> <span class="content"> Does <var>response</var> allow blanket enforcment of policy from <var>request</var>? </span></a>
       <ol class="toc">
        <li><a href="#intersection-source-expressions"><span class="secno">4.2.1</span> <span class="content"> What is an intersection of two expressions matching <span><code>scheme-source</code></span> or <span><code>host-source</code></span> grammar <var>A</var> and <var>B</var>? </span></a>
        <li><a href="#rewrite-self"><span class="secno">4.2.2</span> <span class="content"> Rewrite <code>'self'</code> into a host-source expression for <var>origin</var>. </span></a>
        <li><a href="#subsume-source-expressions"><span class="secno">4.2.3</span> <span class="content"> Does <code>source expression</code> <var>A</var> subsume <code>source expression</code> <var>B</var>? </span></a>
        <li><a href="#subsume-source-list"><span class="secno">4.2.4</span> <span class="content"> Does <span>source list</span> <var>A</var> subsume <span>source list</span><var>B</var> given their
    respective <span>origins</span> and directive names? </span></a>
        <li><a href="#subsume-policy"><span class="secno">4.2.5</span> <span class="content"> Does <span>policy</span> <var>A</var> subsume <span>policy</span> <var>B</var> given their respective <span>origins</span>? </span></a>
       </ol>
      <li><a href="#subsume-policy-list"><span class="secno">4.3</span> <span class="content"> Does <var>subsuming policy</var> subsume <var>policy list</var> given their respective <span>origins</span>? </span></a>
     </ol>
    <li>
     <a href="#security-and-privacy-considerations"><span class="secno">5</span> <span class="content">Security and Privacy Considerations</span></a>
     <ol class="toc">
      <li><a href="#policy-enforcement"><span class="secno">5.1</span> <span class="content">Policy Enforcement</span></a>
      <li><a href="#policy-leakage"><span class="secno">5.2</span> <span class="content">Policy Leakage</span></a>
      <li><a href="#exfiltration"><span class="secno">5.3</span> <span class="content">Data Exfiltration</span></a>
      <li><a href="#header-injection"><span class="secno">5.4</span> <span class="content">Header Injection</span></a>
      <li><a href="#header-reflection"><span class="secno">5.5</span> <span class="content">Header Reflection</span></a>
     </ol>
    <li>
     <a href="#authoring-considerations"><span class="secno">6</span> <span class="content">Authoring Considerations</span></a>
     <ol class="toc">
      <li><a href="#effect-self"><span class="secno">6.1</span> <span class="content"> Requiring <code>'self'</code> </span></a>
     </ol>
    <li><a href="#iana"><span class="secno">7</span> <span class="content">IANA Considerations</span></a>
    <li>
     <a href="#conformance"><span class="secno"></span> <span class="content">Conformance</span></a>
     <ol class="toc">
      <li><a href="#conventions"><span class="secno"></span> <span class="content">Document conventions</span></a>
      <li><a href="#conformant-algorithms"><span class="secno"></span> <span class="content">Conformant Algorithms</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
     </ol>
    <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL Index</span></a>
    <li><a href="#issues-index"><span class="secno"></span> <span class="content">Issues Index</span></a>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#intro"></a></h2>
   <p><em>This section is not normative.</em></p>
   <p>Content Security Policy is a great defense against cross-site scripting
  attacks, allowing developers to harden their own sites against injection of
  malicious script, style, and other resource types. It does not, however,
  give developers the ability to apply restrictions to third-party content
  loaded in via <code>&lt;iframe></code>. Allowing CSP to apply directly to these third-party
  contexts would be dangerous; CSP gives quite granular control over resource
  loading, and itâs very possible to introduce vulnerabilities into an otherwise
  secure page by denying it access to particular scripts. Weâve seen these kinds
  of issues in past features such as <code>X-XSS-Protection</code>, so we must be careful
  to avoid reintroducing them in a new form.</p>
   <p>That said, it would be quite useful to be able to place restrictions upon
  widgets, advertisements, and other kinds of third-party content. This document
  proposes a mechanism which relies on an explicit opt-in from the embedded
  content, which ought to make it possible for widgets to cooperate with their
  embedders to negotiate a reasonable set of restrictions.</p>
   <p>In short, the embedder proposes a Content Security Policy by setting an attribute on an <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/embedded-content.html#the-iframe-element">iframe</a></code> element. This policy is transmitted along with the HTTP request for the framed content in an
  HTTP request header (<a data-link-type="http-header" href="#http-headerdef-sec-required-csp" id="ref-for-http-headerdef-sec-required-csp-1"><code>Sec-Required-CSP</code></a>). If the embedded content can accept that
  policy, it can enforce it by returning a <a data-link-type="http-header" href="https://w3c.github.io/webappsec-csp/#header-content-security-policy"><code>Content-Security-Policy</code></a> or <a data-link-type="http-header" href="#http-headerdef-allow-csp-from" id="ref-for-http-headerdef-allow-csp-from-1"><code>Allow-CSP-From</code></a> header along with the response.</p>
   <p>If the response contains a policy at least as strict as the policy which the embedder requested,
  or accepts the embedder-provided policy, then the user agent will render the embedded content. If
  no such assertion is present, the response will be blocked.</p>
   <h3 class="heading settled" data-level="1.1" id="examples"><span class="secno">1.1. </span><span class="content">Examples</span><a class="self-link" href="#examples"></a></h3>
   <div class="example" id="example1">
    <a class="self-link" href="#example1"></a> MegaCorp Inc. wishes to ensure that the advertisements that run on its
    various publications are locked down to include script from trusted origins
    that have been audited for safety. They can do so by including the
    advertisement via an <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/embedded-content.html#the-iframe-element">iframe</a></code> element with a <code><a data-link-type="element-sub" href="#element-attrdef-iframe-csp" id="ref-for-element-attrdef-iframe-csp-1">csp</a></code> attribute: 
<pre>&lt;iframe src="https://advertisements-r-us.example.com/ad1.cfm"
        <a data-link-type="element-attr" href="#element-attrdef-iframe-csp" id="ref-for-element-attrdef-iframe-csp-2">csp</a>="script-src https://trusted-cdn.example.com/">
&lt;/iframe>
</pre>
    <p>This will generate a request to <code>advertisements-r-us.example.com</code> that has
    a <a data-link-type="http-header" href="#http-headerdef-sec-required-csp" id="ref-for-http-headerdef-sec-required-csp-2"><code>Sec-Required-CSP</code></a> header, as follows:</p>
<pre>GET / HTTP/1.1
Host: advertisements-r-us.example.com
...
<a data-link-type="http-header" href="#http-headerdef-sec-required-csp" id="ref-for-http-headerdef-sec-required-csp-3">Sec-Required-CSP</a>: script-src https://trusted-cdn.example.com/
...
</pre>
    <p>The advertisement server parses this request header, decides that itâs acceptable, and adds a
    header to the response, informing the user agent that it will adhere to the restrictions imposed
    by its embedder (<code>https://example.com</code>):</p>
<pre>HTTP/1.1 200 OK
...
<a data-link-type="http-header" href="#http-headerdef-allow-csp-from" id="ref-for-http-headerdef-allow-csp-from-2">Allow-CSP-From</a>: https://example.com
</pre>
   </div>
   <div class="example" id="example2">
    <a class="self-link" href="#example2"></a> The advertisement server in the example above could also accept the restrictions by emitting its
    own <a data-link-type="http-header" href="https://w3c.github.io/webappsec-csp/#header-content-security-policy"><code>Content-Security-Policy</code></a> header thatâs at least as strong as the policy
    which the embedder requires. For example, it might wish to ensure that no plugins are loaded,
    regardless of what the embedder allows. It can do so by emitting a policy that includes the
    embedderâs restrictions, and adds more on top: 
<pre>HTTP/1.1 200 OK
...
<a data-link-type="dfn" href="https://www.w3.org/TR/CSP3/#header-content-security-policy">Content-Security-Policy</a>: script-src https://trusted-cdn.example.com/; object-src 'none'
</pre>
    <p>Since the policy asserted by the response allows strictly fewer requests than the policy
    required by the request, the frame loads successfully.</p>
    <p>Note that the server could also deliver two policies, one which mirrors the restrictions of the
    embedder exactly, another which tightens them:</p>
<pre>HTTP/1.1 200 OK
...
<a data-link-type="dfn" href="https://www.w3.org/TR/CSP3/#header-content-security-policy">Content-Security-Policy</a>: script-src https://trusted-cdn.example.com/,
                         object-src 'none'
</pre>
    <p>The "<code>,</code>" in the <a data-link-type="dfn" href="https://www.w3.org/TR/CSP3/#header-content-security-policy"><code>Content-Security-Policy</code></a> headerâs value splits the
    string into two serialized policies, each of which is enforced. The user
    agent verifies that one of the policies delivered with the response matches
    the requirement, and since additional policies can only make the <em>effective</em> policy for the page more restrictive, allows the frame
    to load successfully.</p>
   </div>
   <section>
    <h2 class="heading settled" data-level="2" id="framework"><span class="secno">2. </span><span class="content">Framework</span><a class="self-link" href="#framework"></a></h2>
    <p>At a high level, this document describes a mechanism by which an embedee can opt-into a set of
  restrictions specified by its embedder. The mechanism involves a few steps:</p>
    <ol>
     <li data-md="">
      <p>The embedder specifies a required policy via a <code><a data-link-type="element-sub" href="#element-attrdef-iframe-csp" id="ref-for-element-attrdef-iframe-csp-3">csp</a></code> attribute on an <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/embedded-content.html#the-iframe-element">iframe</a></code> element. This is described in more detail in <a href="#csp-attribute">Â§2.1 &lt;iframe>'s csp attribute</a>.</p>
     <li data-md="">
      <p>That attributeâs value will be sent along with any <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#navigation-request">navigation request</a> that targets
  the <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/embedded-content.html#the-iframe-element">iframe</a></code>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#nested-browsing-context">nested browsing context</a> in a <a data-link-type="http-header" href="#http-headerdef-sec-required-csp" id="ref-for-http-headerdef-sec-required-csp-4"><code>Sec-Required-CSP</code></a> HTTP request header. This header is described in more detail in <a href="#required-csp-header">Â§2.2 The Sec-Required-CSP HTTP Request Header</a>.</p>
     <li data-md="">
      <p>The server can examine the <a data-link-type="http-header" href="#http-headerdef-sec-required-csp" id="ref-for-http-headerdef-sec-required-csp-5"><code>Sec-Required-CSP</code></a> header to determine whether
  it wishes to accept the required policy.If so, it can implicitly opt-in by sending a <a data-link-type="http-header" href="https://w3c.github.io/webappsec-csp/#header-content-security-policy"><code>Content-Security-Policy</code></a> header in the response that contains a policy
  which is at least as strong as the required policy, or explicitly opt-in by sending an <a data-link-type="http-header" href="#http-headerdef-allow-csp-from" id="ref-for-http-headerdef-allow-csp-from-3"><code>Allow-CSP-From</code></a> header in the response that enables the embedding origin
  to set whatever policy it wishes. The explicit mechanism is straightforward, described in <a href="#allow-csp-from-header">Â§2.3 The Allow-CSP-From HTTP Response Header</a>. The implicit mechanism is quite complicated, and comprises the
  entire <a href="#implicit-opt-in">Â§3 Implicit Policy Acceptance</a> section.</p>
      <p>If the server doesnât wish to accept the required policy, it can return an explicit error,
  or simply return the usual data without either a matching <a data-link-type="http-header" href="https://w3c.github.io/webappsec-csp/#header-content-security-policy"><code>Content-Security-Policy</code></a> header or an <a data-link-type="http-header" href="#http-headerdef-allow-csp-from" id="ref-for-http-headerdef-allow-csp-from-4"><code>Allow-CSP-From</code></a> header. In this case, the user agent will block the response. This integration with HTMLâs <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#navigate">navigate</a> algorithm is described in <a href="#html-integration">Â§2.4 Integration with HTML</a>, and the blocking mechanism
  is spelled out in <a href="#process-response">Â§4.1 Is response to request blocked by contextâs required CSP?</a>.</p>
    </ol>
    <h3 class="heading settled" data-level="2.1" id="csp-attribute"><span class="secno">2.1. </span><span class="content"><code>&lt;iframe></code>'s <code>csp</code> attribute</span><a class="self-link" href="#csp-attribute"></a></h3>
    <p><code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/embedded-content.html#the-iframe-element">iframe</a></code> elements have a <dfn class="dfn-paneled" data-dfn-for="iframe" data-dfn-type="element-attr" data-export="" id="element-attrdef-iframe-csp">csp</dfn> attribute, which specifies
  the policy that an embedded document must agree to enforce upon itself. For example, the following
  HTML would load <code>https://embedee.example.com/</code>, and ensure that <code>object-src 'none'</code> was enforced
  upon it:</p>
    <div class="example" id="example-cf99059b">
     <a class="self-link" href="#example-cf99059b"></a> 
<pre>&lt;iframe src="https://embedee.example.com/" <a data-link-type="element-attr" href="#element-attrdef-iframe-csp" id="ref-for-element-attrdef-iframe-csp-4">csp</a>="object-src 'none'">
&lt;/iframe>
</pre>
    </div>
    <p>A <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string">string</a> (<var>value</var>) is a <dfn class="dfn-paneled" data-dfn-for="iframe/csp" data-dfn-type="dfn" data-noexport="" id="iframe-csp-valid-attribute-value">valid attribute value</dfn> for a given <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-element">element</a> (<var>element</var>)'s <code><a data-link-type="element-sub" href="#element-attrdef-iframe-csp" id="ref-for-element-attrdef-iframe-csp-5">csp</a></code> <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#concept-element-attributes">content attribute</a> if all of the
  following statements are true:</p>
    <ol>
     <li data-md="">
      <p><var>value</var> is not the empty string.</p>
     <li data-md="">
      <p><var>value</var> matches the <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-serialized-policy">serialized-policy</a> ABNF grammar defined in <a data-link-type="biblio" href="#biblio-csp3">[CSP3]</a>.</p>
     <li data-md="">
      <p><var>element</var>âs <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-document">node document</a>âs <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-document-bc">browsing context</a>âs <a data-link-type="dfn" href="#browsing-context-required-csp" id="ref-for-browsing-context-required-csp-1">required CSP</a> is <code>null</code>, or the result of <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#parse-serialized-policy">parsing <var>value</var> as "<code>enforce</code>"</a> is <a data-link-type="dfn" href="#policy-subsumed-by" id="ref-for-policy-subsumed-by-1">subsumed by</a> <var>element</var>âs <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-document">node document</a>âs <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-document-bc">browsing
  context</a>âs <a data-link-type="dfn" href="#browsing-context-required-csp" id="ref-for-browsing-context-required-csp-2">required CSP</a>.</p>
    </ol>
    <div class="example" id="example-5d5a9bc3">
     <a class="self-link" href="#example-5d5a9bc3"></a> The following strings are valid values for the <code><a data-link-type="element-sub" href="#element-attrdef-iframe-csp" id="ref-for-element-attrdef-iframe-csp-6">csp</a></code> attribute, as theyâre valid CSP
    grammar: 
     <ul>
      <li data-md="">
       <p><code>script-src 'none'</code></p>
      <li data-md="">
       <p><code>script-src 'self'; object-src 'none'; sandbox</code></p>
      <li data-md="">
       <p><code>not-a-directive https://whatever.not-a-tld</code></p>
     </ul>
     <p class="note" role="note"><span>Note:</span> We consider the last item valid even though it doesnât express a meaningful policy in
    order to remain forward-compatible with future CSP syntax.</p>
     <p>The following, on the other hand, do not match the CSP syntax, and would not be considered valid
    attribute values:</p>
     <ul>
      <li data-md="">
       <p><code>script-src *\nInjected-Header: XSS!</code></p>
      <li data-md="">
       <p><code>ð©</code></p>
     </ul>
     <p class="note" role="note"><span>Note:</span> We need to be careful about the values we allow in the <code><a data-link-type="element-sub" href="#element-attrdef-iframe-csp" id="ref-for-element-attrdef-iframe-csp-7">csp</a></code> attribute, as its
    contents will end up reflected as an HTTP request header. This concern is discussed in a little
    more detail in <a href="#header-injection">Â§5.4 Header Injection</a>.</p>
    </div>
    <p><code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/embedded-content.html#the-iframe-element">iframe</a></code>'s <code><a data-link-type="element-sub" href="#element-attrdef-iframe-csp" id="ref-for-element-attrdef-iframe-csp-8">csp</a></code> <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#concept-element-attributes">content attribute</a> has a corresponding IDL attribute, defined
  by the following WebIDL grammar <a data-link-type="biblio" href="#biblio-webidl">[WEBIDL]</a>:</p>
<pre class="idl highlight def"><span class="kt">partial</span> <span class="kt">interface</span> <a class="nv idl-code" data-link-type="interface" href="https://html.spec.whatwg.org/multipage/embedded-content.html#htmliframeelement">HTMLIFrameElement</a> {
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://html.spec.whatwg.org/multipage/scripting.html#cereactions">CEReactions</a>] <span class="kt">attribute</span> <a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString"><span class="kt">DOMString</span></a> <dfn class="nv dfn-paneled idl-code" data-dfn-for="HTMLIFrameElement" data-dfn-type="attribute" data-export="" data-type="DOMString" id="dom-htmliframeelement-csp">csp</dfn>;
};
</pre>
    <div class="algorithm" data-algorithm="HTMLIframeElementâs csp IDL attributeâs getter">
      The <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/embedded-content.html#htmliframeelement">HTMLIFrameElement</a></code> <code class="idl"><a data-link-type="idl" href="#dom-htmliframeelement-csp" id="ref-for-dom-htmliframeelement-csp-1">csp</a></code> IDL attributeâs <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-getter">getter</a> will run the
    following steps on a given <var>element</var>: 
     <ol>
      <li data-md="">
       <p>Let <var>value</var> be the value of <var>element</var>âs <code><a data-link-type="element-sub" href="#element-attrdef-iframe-csp" id="ref-for-element-attrdef-iframe-csp-9">csp</a></code> <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#concept-element-attributes">content attribute</a>.</p>
      <li data-md="">
       <p>If <var>value</var> is a <a data-link-type="dfn" href="#iframe-csp-valid-attribute-value" id="ref-for-iframe-csp-valid-attribute-value-1">valid attribute value</a> for <var>element</var>, return <var>value</var>.</p>
      <li data-md="">
       <p>Return the empty string.</p>
     </ol>
    </div>
    <div class="algorithm" data-algorithm="HTMLIframeElementâs csp IDL attributeâs setter">
      The <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/embedded-content.html#htmliframeelement">HTMLIFrameElement</a></code> <code class="idl"><a data-link-type="idl" href="#dom-htmliframeelement-csp" id="ref-for-dom-htmliframeelement-csp-2">csp</a></code> IDL attributeâs <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-setter">setter</a> will run the
    following steps on a given <var>element</var> for a given <var>value</var>: 
     <ol>
      <li data-md="">
       <p>If <var>value</var> is a <a data-link-type="dfn" href="#iframe-csp-valid-attribute-value" id="ref-for-iframe-csp-valid-attribute-value-2">valid attribute value</a> for <var>element</var>, set <var>element</var>âs <code><a data-link-type="element-sub" href="#element-attrdef-iframe-csp" id="ref-for-element-attrdef-iframe-csp-10">csp</a></code> <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#concept-element-attributes">content attribute</a> to the empty string and return.</p>
      <li data-md="">
       <p>Set <var>element</var>âs <code><a data-link-type="element-sub" href="#element-attrdef-iframe-csp" id="ref-for-element-attrdef-iframe-csp-11">csp</a></code> <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#concept-element-attributes">content attribute</a> to the empty string.</p>
     </ol>
    </div>
    <p class="issue" id="issue-2a91d948"><a class="self-link" href="#issue-2a91d948"></a> Upstream this to all the HTMLs.</p>
    <h3 class="heading settled" data-level="2.2" id="required-csp-header"><span class="secno">2.2. </span><span class="content">The <code>Sec-Required-CSP</code> HTTP Request Header</span><a class="self-link" href="#required-csp-header"></a></h3>
    <p>In order to ensure that the embedded resource can decide whether or not it is willing to adhere to
  the embedderâs requirements, the policy expressed in an <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/embedded-content.html#the-iframe-element">iframe</a></code>'s <code><a data-link-type="element-sub" href="#element-attrdef-iframe-csp" id="ref-for-element-attrdef-iframe-csp-12">csp</a></code> attribute is
  communicated along with affected <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#navigation-request">navigation requests</a> via a
  "<dfn class="dfn-paneled" data-dfn-type="http-header" data-export="" id="http-headerdef-sec-required-csp"><code>Sec-Required-CSP</code></dfn>" HTTP request header. The headerâs value is
  represented by the following ABNF <a data-link-type="biblio" href="#biblio-rfc5234">[RFC5234]</a>:</p>
<pre>Sec-Required-CSP = <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-serialized-policy">serialized-policy</a>
</pre>
    <p>A user agent MUST NOT send more than one HTTP response header field named "<code>Sec-Required-CSP</code>", and
  any such header MUST NOT contain more than one <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-serialized-policy">serialized-policy</a>.</p>
    <p>Servers MUST process only the first policy in the first such header received. As discussed in <a href="#header-reflection">Â§5.5 Header Reflection</a>, servers SHOULD also carefully consider the implications of simply
  reflecting a policy back to a client. If the server wishes to simply accept an embedderâs
  requirements, the <a data-link-type="http-header" href="#http-headerdef-allow-csp-from" id="ref-for-http-headerdef-allow-csp-from-5"><code>Allow-CSP-From</code></a> header is a safer choice.</p>
    <p>This header is set as part of HTMLâs <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#navigate">navigate</a> algorithm (see <a href="#html-integration">Â§2.4 Integration with HTML</a> for
  details on the hook that calls the following algorithm):</p>
    <div class="algorithm" data-algorithm="set a requestâs required-csp header">
      To <dfn class="dfn-paneled" data-dfn-type="abstract-op" data-export="" data-local-lt="set-required-csp" id="abstract-opdef-set-the-sec-required-csp-header">set the <code>Sec-Required-CSP</code> header</dfn> for a
    given <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request">request</a> (<var>request</var>), run the following steps: 
     <ol>
      <li data-md="">
       <p>If <var>request</var> is not a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#navigation-request">navigation request</a>, return.</p>
      <li data-md="">
       <p>Let <var>requirement</var> be <var>request</var>âs <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-client">client</a>âs <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#responsible-browsing-context">responsible browsing context</a>âs <a data-link-type="dfn" href="#browsing-context-required-csp" id="ref-for-browsing-context-required-csp-3">required CSP</a>.</p>
      <li data-md="">
       <p>If <var>requirement</var> is <code>null</code>, return.</p>
      <li data-md="">
       <p class="assertion">Assert: <var>requirement</var> is a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#serialized-csp">serialized CSP</a>, matching the <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-serialized-policy">serialized-policy</a> grammar defined in <a data-link-type="biblio" href="#biblio-csp3">[CSP3]</a>.</p>
      <li data-md="">
       <p><a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header-list-append">Append</a> a header named "<a data-link-type="http-header" href="#http-headerdef-sec-required-csp" id="ref-for-http-headerdef-sec-required-csp-6"><code>Sec-Required-CSP</code></a>" with a
  value of <var>requirement</var> to <var>request</var>âs <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-header-list">header list</a>.</p>
     </ol>
    </div>
    <h3 class="heading settled" data-level="2.3" id="allow-csp-from-header"><span class="secno">2.3. </span><span class="content">The <code>Allow-CSP-From</code> HTTP Response Header</span><a class="self-link" href="#allow-csp-from-header"></a></h3>
    <p>An embedee can opt-into accepting a policy specified by an embedder by responding with a
  "<dfn class="dfn-paneled" data-dfn-type="http-header" data-export="" id="http-headerdef-allow-csp-from"><code>Allow-CSP-From</code></dfn>" HTTP response header. The headerâs value is
  represented by the following ABNF <a data-link-type="biblio" href="#biblio-rfc5234">[RFC5234]</a>:</p>
<pre>Allow-CSP-From = <a data-link-type="grammar" href="https://fetch.spec.whatwg.org/#http-origin">origin-or-null</a> / <a data-link-type="grammar" href="https://fetch.spec.whatwg.org/#http-new-header-syntax">wildcard</a>
</pre>
    <h3 class="heading settled" data-level="2.4" id="html-integration"><span class="secno">2.4. </span><span class="content">Integration with HTML</span><a class="self-link" href="#html-integration"></a></h3>
    <ol>
     <li data-md="">
      <p><code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/embedded-content.html#the-iframe-element">iframe</a></code> elements have a <code><a data-link-type="element-sub" href="#element-attrdef-iframe-csp" id="ref-for-element-attrdef-iframe-csp-13">csp</a></code> attribute, defined in <a href="#csp-attribute">Â§2.1 &lt;iframe>'s csp attribute</a>.</p>
     <li data-md="">
      <p>Each <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#browsing-context">browsing context</a> has a <a data-link-type="dfn" href="#browsing-context-required-csp" id="ref-for-browsing-context-required-csp-4">required CSP</a>, defined in <a href="#required-csp">Â§2.4.1 Browsing Contextâs Required CSP</a>.</p>
     <li data-md="">
      <p>Add the following after step 10 of HTMLâs <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#navigate">navigate</a> algorithm:</p>
      <ol start="11">
       <li data-md="">
        <p><a data-link-type="abstract-op" href="#abstract-opdef-set-the-required-csp" id="ref-for-abstract-opdef-set-the-required-csp-1">Set</a> <code>browsingContext</code>'s <a data-link-type="dfn" href="#browsing-context-required-csp" id="ref-for-browsing-context-required-csp-5">required CSP</a>.</p>
      </ol>
      <p class="issue" id="issue-fdc1da1f"><a class="self-link" href="#issue-fdc1da1f"></a> Upstream this to WHATWGâs HTML.</p>
      <p class="issue" id="issue-9e9d2c02"><a class="self-link" href="#issue-9e9d2c02"></a> W3Câs HTMLâs navigation algorithm is wildly divergent from WHATWGâs at
  this point. Upstream something to that document once things are reconciled. <a href="https://github.com/w3c/html/issues/584">&lt;https://github.com/w3c/html/issues/584></a></p>
     <li data-md="">
      <p>Add the following to the list of error conditions in step 1 of HTMLâs <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#process-a-navigate-response">process a navigate response</a> algorithm:</p>
      <ul>
       <li data-md="">
        <p>The <a href="#process-response">Â§4.1 Is response to request blocked by contextâs required CSP?</a> algorithm returns "<code>Blocked</code>" when executed
  upon <code>response</code>, <code>request</code>, and <code>browsingContext</code>.</p>
      </ul>
      <p class="issue" id="issue-fdc1da1f0"><a class="self-link" href="#issue-fdc1da1f0"></a> Upstream this to WHATWGâs HTML.</p>
      <p class="issue" id="issue-a3a64cc9"><a class="self-link" href="#issue-a3a64cc9"></a> W3Câs HTML is not based on Fetch, and does not have
  a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#process-a-navigate-response">process a navigate response</a> algorithm into which to hook. <a href="https://github.com/w3c/html/issues/584">&lt;https://github.com/w3c/html/issues/584></a></p>
     <li data-md="">
      <p>Add the following after step 5 of HTMLâs <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#process-a-navigate-fetch">process a navigate fetch</a> algorithm:</p>
      <ol start="6">
       <li data-md="">
        <p><a data-link-type="abstract-op" href="#abstract-opdef-set-the-sec-required-csp-header" id="ref-for-abstract-opdef-set-the-sec-required-csp-header-1">Set</a> <code>request</code>'s
  "<a data-link-type="http-header" href="#http-headerdef-sec-required-csp" id="ref-for-http-headerdef-sec-required-csp-7"><code>Sec-Required-CSP</code></a>" header.</p>
      </ol>
      <p class="issue" id="issue-fdc1da1f1"><a class="self-link" href="#issue-fdc1da1f1"></a> Upstream this to WHATWGâs HTML.</p>
      <p class="issue" id="issue-7b3609ea"><a class="self-link" href="#issue-7b3609ea"></a> W3Câs HTML is not based on Fetch, and does not have
  a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#process-a-navigate-fetch">process a navigate fetch</a> algorithm into which to hook. <a href="https://github.com/w3c/html/issues/584">&lt;https://github.com/w3c/html/issues/584></a></p>
    </ol>
    <h4 class="heading settled" data-level="2.4.1" id="required-csp"><span class="secno">2.4.1. </span><span class="content">Browsing Contextâs Required CSP</span><a class="self-link" href="#required-csp"></a></h4>
    <p>Each <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#browsing-context">browsing context</a> has a <dfn class="dfn-paneled" data-dfn-for="browsing context" data-dfn-type="dfn" data-noexport="" id="browsing-context-required-csp">required CSP</dfn>, which is either <code>null</code> or a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#serialized-csp">serialized CSP</a>. The value is set during the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#navigate">navigate</a> algorithm, and will
  not change until the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#browsing-context">browsing context</a>âs <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#active-document">active document</a> changes.</p>
    <p>The following algorithm will execute at around step 10 of the current <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#navigate">navigate</a> algorithm:</p>
    <div class="algorithm" data-algorithm="browsing contextâs required CSP">
      To <dfn class="dfn-paneled" data-dfn-type="abstract-op" data-export="" id="abstract-opdef-set-the-required-csp">set the required CSP</dfn> for a given <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#browsing-context">browsing context</a> (<var>context</var>),
    run the following steps: 
     <ol>
      <li data-md="">
       <p>If <var>context</var> is a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#nested-browsing-context">nested browsing context</a>:</p>
       <ol>
        <li data-md="">
         <p>If <var>context</var>âs <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#browsing-context-container">browsing context container</a> has an <code><a data-link-type="element-sub" href="#element-attrdef-iframe-csp" id="ref-for-element-attrdef-iframe-csp-14">csp</a></code> <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#concept-element-attributes">content
  attribute</a> with a <a data-link-type="dfn" href="#iframe-csp-valid-attribute-value" id="ref-for-iframe-csp-valid-attribute-value-3">valid attribute value</a> (<var>value</var>), set <var>context</var>âs <a data-link-type="dfn" href="#browsing-context-required-csp" id="ref-for-browsing-context-required-csp-6">required CSP</a> to <var>value</var> and return.</p>
        <li data-md="">
         <p>Set <var>context</var>âs <a data-link-type="dfn" href="#browsing-context-required-csp" id="ref-for-browsing-context-required-csp-7">required CSP</a> to the value of <var>context</var>âs <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#parent-browsing-context">parent browsing context</a>âs <a data-link-type="dfn" href="#browsing-context-required-csp" id="ref-for-browsing-context-required-csp-8">required CSP</a>.</p>
       </ol>
      <li data-md="">
       <p>Set <var>context</var>âs <a data-link-type="dfn" href="#browsing-context-required-csp" id="ref-for-browsing-context-required-csp-9">required CSP</a> to <code>null</code>.</p>
     </ol>
    </div>
    <p class="issue" id="issue-b71d345b"><a class="self-link" href="#issue-b71d345b"></a> Upstream a hook to HTML.</p>
   </section>
   <section>
    <h2 class="heading settled" data-level="3" id="implicit-opt-in"><span class="secno">3. </span><span class="content">Implicit Policy Acceptance</span><a class="self-link" href="#implicit-opt-in"></a></h2>
    <p>An embedee can explicitly accept a policy requirement specified by its embedder by returning an <a data-link-type="http-header" href="#http-headerdef-allow-csp-from" id="ref-for-http-headerdef-allow-csp-from-6"><code>Allow-CSP-From</code></a> header along with a response. The requirement can also be
  implicitly accepted by delivering a <a data-link-type="http-header" href="https://w3c.github.io/webappsec-csp/#header-content-security-policy"><code>Content-Security-Policy</code></a> header that
  contains a policy (or set of policies) whose net effect is at least as strict as the policy
  required by the embedder.</p>
    <p>"At least as strict", however, isnât very precise. Simple cases are straightforward: if an
  embedder requires <code>object-src https://cdn.example.com</code>, the embedee can respond with <code>object-src 'none'</code>. Since every possible resource that would be blocked by the former would also be blocked
  by the latter (because it allows no objects at all), we wouldnât block the embedding. CSPâs
  syntactical complexity makes this a little bit difficult to reason about for more complicated
  cases. For instance, given <code>script-src 'unsafe-inline' http: 'sha256-abc...def'</code>, it might appear
  that <code>script-src 'unsafe-inline'</code> would be a subset of the required policy. The presence of the <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-hash-source">hash-source</a> expression, however means that <code>'unsafe-inline'</code> is ignored in the
  required policy, so the latter policy would actually allow more than the former, despite
  appearances.</p>
    <p>To formalize the concept a bit, we need a few terms, and more than a few algorithms:</p>
    <ul>
     <li data-md="">
      <p>A <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#violation-policy">policy</a> (<var>A</var>) is said to <dfn class="dfn-paneled" data-dfn-for="policy" data-dfn-type="dfn" data-export="" id="policy-subsume">subsume</dfn> another <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#violation-policy">policy</a> (<var>B</var>) if <var>B</var> is at least as strict as <var>A</var>. In this case <var>B</var> could also be said to be <dfn class="dfn-paneled" data-dfn-for="policy" data-dfn-type="dfn" data-export="" id="policy-subsumed-by">subsumed by</dfn> <var>A</var>. The details of determining "at least as
  strict"ness are spelled out in <a href="#subsumption">Â§3.2 Subsumption</a>.</p>
     <li data-md="">
      <p>When multiple policies are present, they have a combined effect which is described in <a href="https://www.w3.org/TR/CSP3/#multiple-policies">Content Security Policy Level 3 Â§multiple-policies</a>. Here, weâll talk about the combined effect of a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list">list</a> of <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#violation-policy">policy</a> objects as their <dfn class="dfn-paneled" data-dfn-for="policy" data-dfn-type="dfn" data-export="" id="policy-intersection">intersection</dfn>. The details of
  determining that are spelled out in <a href="#intersection">Â§3.1 Intersection</a>.</p>
     <li data-md="">
      <p>A <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#violation-policy">policy</a> (<var>A</var>) is said to <a data-link-type="dfn" href="#policy-subsume" id="ref-for-policy-subsume-1">subsume</a> a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list">list</a> of <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#violation-policy">policy</a> objects if <var>A</var> <a data-link-type="dfn" href="#policy-subsume" id="ref-for-policy-subsume-2">subsumes</a> their <a data-link-type="dfn" href="#policy-intersection" id="ref-for-policy-intersection-1">intersection</a>.</p>
    </ul>
    <h3 class="heading settled" data-level="3.1" id="intersection"><span class="secno">3.1. </span><span class="content">Intersection</span><a class="self-link" href="#intersection"></a></h3>
    <h4 class="heading settled" data-level="3.1.1" id="intersection-policy-list"><span class="secno">3.1.1. </span><span class="content">Policy List intersection</span><a class="self-link" href="#intersection-policy-list"></a></h4>
    <div class="algorithm" data-algorithm="intersection of policy list">
      Given a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list">list</a> of <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#violation-policy">policies</a> (<var>policy list</var>) and an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin">origin</a> (<var>origin</var>),
    the <dfn data-dfn-type="abstract-op" data-export="" id="abstract-opdef-intersection-of-policy-list-for-origin">intersection of <var>policy list</var> for <var>origin</var><a class="self-link" href="#abstract-opdef-intersection-of-policy-list-for-origin"></a></dfn> is a single <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#violation-policy">policy</a> object representing their net effect, produced by the following algorithm: 
     <p class="note" role="note"><span>Note:</span> It isnât always possible to represent the <a data-link-type="dfn" href="#policy-intersection" id="ref-for-policy-intersection-2">intersection</a> of multiple
    policies as a single policy. Consider <code>script-src 'unsafe-inline'</code> and <code>script-src 'nonce-abc'</code>,
    for instance: the former allows only inline script, the latter allows only inline or
    externalized script with a particular token. The net effect (only inline script with a
    particular token) cannot be created with a single policy. Dealing with such policies is, for the
    moment, left as an exercise for the reader.</p>
     <p class="issue" id="issue-f2ff64e0"><a class="self-link" href="#issue-f2ff64e0"></a> We shouldnât make the reader do this exercise.</p>
     <ol>
      <li data-md="">
       <p>Let <var>intersection</var> be a <a data-link-type="dfn" href="https://www.w3.org/TR/CSP3/#policy">policy</a> object with an empty <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#policy-directive-set">directive set</a> and a disposition of "<code>enforce</code>".</p>
      <li data-md="">
       <p>For each <var>policy</var> in <var>policy list</var>:</p>
       <ol>
        <li data-md="">
         <p>If <var>policy</var>âs <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#policy-disposition">disposition</a> is "<code>report</code>", <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue">continue</a>.</p>
        <li data-md="">
         <p>Let <var>result</var> be the <a data-link-type="abstract-op" href="#abstract-opdef-intersection-of-two-policies" id="ref-for-abstract-opdef-intersection-of-two-policies-1">intersection
  of <var>intersection</var> and <var>policy</var> for <var>origin</var></a></p>
        <li data-md="">
         <p>Set <var>intersection</var> to <var>result</var>.</p>
       </ol>
      <li data-md="">
       <p>Return <var>intersection</var>.</p>
     </ol>
    </div>
    <div class="example" id="example-b4991076">
     <a class="self-link" href="#example-b4991076"></a> The intersection of the policies created by parsing each item in the following list of <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#serialized-csp">serialized CSPs</a>: 
<pre>Â«
    "default-src 'self' http://example.com http://example.net;
     connect-src 'none';",
    "connect-src http://example.com/;
     script-src http://example.com/",
    "style-src 'self';
     script-src http://example.com/ http://example.net",
Â»
</pre>
     <p>is the policy created by parsing the following <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#serialized-csp">serialized CSP</a>:</p>
<pre>"default-src 'self' http://example.com http://example.net;
 connect-src 'none';
 script-src http://example.com/;
 style-src 'self'"
</pre>
     <p>Each policy specified in the initial list <a data-link-type="dfn" href="#policy-subsume" id="ref-for-policy-subsume-3">subsumes</a> the intersection.</p>
    </div>
    <h4 class="heading settled" data-level="3.1.2" id="intersection-policy"><span class="secno">3.1.2. </span><span class="content">Policy Intersection</span><a class="self-link" href="#intersection-policy"></a></h4>
    <div class="algorithm" data-algorithm="intersection of two policies">
      Given two <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#violation-policy">policies</a> (<var>A</var> and <var>B</var>), and an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin">origin</a> (<var>origin</var>), the <dfn class="dfn-paneled" data-dfn-type="abstract-op" data-export="" data-lt="intersection of two policies" id="abstract-opdef-intersection-of-two-policies">intersection of <var>A</var> and <var>B</var> for <var>origin</var></dfn> is a single <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#violation-policy">policy</a> representing their net effect, produced by the
    following algorithm: 
     <ol>
      <li data-md="">
       <p class="assertion">Assert: <var>A</var> and <var>B</var> both have a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#policy-disposition">disposition</a> of "<code>enforce</code>".</p>
      <li data-md="">
       <p>If <var>A</var>âs <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#policy-directive-set">directive set</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-is-empty">is empty</a>, return <var>B</var>.</p>
      <li data-md="">
       <p>If <var>B</var>âs <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#policy-directive-set">directive set</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-is-empty">is empty</a>, return <var>A</var>.</p>
      <li data-md="">
       <p>Let <var>policy</var> be a new <a data-link-type="dfn" href="https://www.w3.org/TR/CSP3/#policy">policy</a> with an empty <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#policy-directive-set">directive set</a>, and a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#policy-disposition">disposition</a> "<code>enforce</code>".</p>
      <li data-md="">
       <p>Let <var>directive names</var> be an empty <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set">set</a>.</p>
      <li data-md="">
       <p>For each <var>directive</var> in <var>A</var>:</p>
       <ol>
        <li data-md="">
         <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append">Append</a> <var>directive</var>âs <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-name">name</a> to <var>directive names</var>.</p>
       </ol>
      <li data-md="">
       <p>For each <var>directive</var> in <var>B</var>:</p>
       <ol>
        <li data-md="">
         <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append">Append</a> <var>directive</var>âs <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-name">name</a> to <var>directive names</var>.</p>
       </ol>
      <li data-md="">
       <p>For each <var>directive name</var> in <var>directive names</var>:</p>
       <ol>
        <li data-md="">
         <p>If <var>directive name</var> is "<code>report-uri</code>", "<code>report-to</code>", <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue">continue</a>.</p>
        <li data-md="">
         <p>Let <var>directive A</var> be the <a data-link-type="dfn" href="#effective-directive-value" id="ref-for-effective-directive-value-1">effective directive value</a> for <var>directive name</var> and <var>A</var>.</p>
        <li data-md="">
         <p>Let <var>directive B</var> be the <a data-link-type="dfn" href="#effective-directive-value" id="ref-for-effective-directive-value-2">effective directive value</a> for <var>directive name</var> and <var>B</var>.</p>
        <li data-md="">
         <p class="assertion">Assert: <var>directive A</var> and <var>directive B</var> are not both <code>null</code>, and either both of their <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-value">values</a> are <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#source-lists">source lists</a>, or neither of their <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-value">values</a> are <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#source-lists">source lists</a>.</p>
        <li data-md="">
         <p>If either <var>directive A</var> or <var>directive B</var> has a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-value">value</a> which is
  not a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#source-lists">source list</a>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue">continue</a>.</p>
         <p class="issue" id="issue-1552fb5c"><a class="self-link" href="#issue-1552fb5c"></a> We need to extend this definition to handle things that are not source lists.
  Also, we should be more precise about this, perhaps by defining a term like "source list
  directive" that we could check against <var>directive name</var>.</p>
        <li data-md="">
         <p>If <var>directive A</var> is <code>null</code>:</p>
         <ol>
          <li data-md="">
           <p>Let <var>directive</var> be a new <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directives">directive</a> with the following properties:</p>
           <dl>
            <dt data-md=""><a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-name">name</a>
            <dd data-md="">
             <p><var>directive name</var></p>
            <dt data-md=""><a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-value">value</a>
            <dd data-md="">
             <p><var>directive B</var>âs <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-value">value</a></p>
           </dl>
          <li data-md="">
           <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append">append</a> a <var>directive</var> to <var>policy</var>âs <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#policy-directive-set">directive set</a>.</p>
          <li data-md="">
           <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue">Continue</a>.</p>
         </ol>
        <li data-md="">
         <p>If <var>directive B</var> is <code>null</code>:</p>
         <ol>
          <li data-md="">
           <p>Let <var>directive</var> be a new <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directives">directive</a> with the following properties:</p>
           <dl>
            <dt data-md=""><a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-name">name</a>
            <dd data-md="">
             <p><var>directive name</var></p>
            <dt data-md=""><a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-value">value</a>
            <dd data-md="">
             <p><var>directive A</var>âs <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-value">value</a></p>
           </dl>
          <li data-md="">
           <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append">append</a> a <var>directive</var> to <var>policy</var>âs <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#policy-directive-set">directive set</a>.</p>
          <li data-md="">
           <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue">Continue</a>.</p>
         </ol>
        <li data-md="">
         <p>Let <var>directive value</var> be the <a data-link-type="abstract-op" href="#abstract-opdef-intersection-of-two-source-lists" id="ref-for-abstract-opdef-intersection-of-two-source-lists-1">intersection of <var>directive A</var>âs </a><a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-value">value</a>, <var>directive B</var>âs <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-value">value</a>, <var>directive
  name</var>, and <var>origin</var>.</p>
        <li data-md="">
         <p>Let <var>directive</var> be a new <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directives">directive</a> with he following properties:</p>
         <dl>
          <dt data-md=""><a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-name">name</a>
          <dd data-md="">
           <p><var>directive name</var></p>
          <dt data-md=""><a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-value">value</a>
          <dd data-md="">
           <p><var>directive value</var></p>
         </dl>
        <li data-md="">
         <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append">Append</a> <var>directive</var> to <var>policy</var>âs <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#policy-directive-set">directive set</a>.</p>
       </ol>
      <li data-md="">
       <p>Return <var>policy</var>.</p>
     </ol>
    </div>
    <div class="example" id="example-1339171b">
     <a class="self-link" href="#example-1339171b"></a> The intersection of the policies obtained by parsing the following <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#serialized-csp">serialized CSPs</a>: 
<pre>"default-src 'self' http://example.com http://example.net;
 connect-src 'none';"

and

"connect-src http://example.com/;
 script-src http://example.com/"
</pre>
     <p>is the policy obtained by parsing the following <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#serialized-csp">serialized CSP</a>:</p>
<pre>"default-src 'self' http://example.com http://example.net;
 connect-src 'none';
 script-src http://example.com/;
</pre>
     <p>Both of the given policies <a data-link-type="dfn" href="#policy-subsume" id="ref-for-policy-subsume-4">subsume</a> the <a data-link-type="dfn" href="#policy-intersection" id="ref-for-policy-intersection-3">intersection</a>. For example,
    the <a data-link-type="dfn" href="#policy-intersection" id="ref-for-policy-intersection-4">intersection</a>âs "<code>script-src http://example.com/</code>" is <a data-link-type="dfn" href="#policy-subsumed-by" id="ref-for-policy-subsumed-by-2">subsumed by</a> the first policyâs "<code>default-src 'self' http://example.com http://example.net</code>" and the second policyâs "<code>script-src http://example.com/</code>".</p>
    </div>
    <h4 class="heading settled" data-level="3.1.3" id="intersection-source-list"><span class="secno">3.1.3. </span><span class="content">Source List Intersection</span><a class="self-link" href="#intersection-source-list"></a></h4>
    <div class="algorithm" data-algorithm="intersection of two source lists">
      Given two <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#source-lists">source lists</a> (<var>A</var> and <var>B</var>), their <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-name">name</a> (<var>name</var>), and
    their <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin">origin</a> (<var>origin</var>), the <dfn class="dfn-paneled" data-dfn-type="abstract-op" data-export="" data-lt="intersection of two source lists" id="abstract-opdef-intersection-of-two-source-lists">intersection of <var>A</var> and <var>B</var> for <var>name</var> and <var>origin</var></dfn> is a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#source-lists">source list</a> representing their net effect. If no such <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#source-expression">source
    expressions</a> exist because the lists contain only divergent expressions (for example: <code>https://example.com/</code> in <var>A</var>, and <code>https://not-example.com/</code> in <var>B</var>), then the intersection
    will be the list Â« <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-none">'none'</a> Â». 
     <ol>
      <li data-md="">
       <p>Let <var>effective A</var> be the <a data-link-type="dfn" href="#effective-source-list" id="ref-for-effective-source-list-1">effective source list</a> for <var>A</var>, <var>directive A</var>, and <var>origin</var>.</p>
      <li data-md="">
       <p>Let <var>effective B</var> be the <a data-link-type="dfn" href="#effective-source-list" id="ref-for-effective-source-list-2">effective source list</a> for <var>B</var>, <var>directive B</var>, and <var>origin</var>.</p>
      <li data-md="">
       <p>If either <var>effective A</var> or <var>effective B</var> is Â« <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-none"><code>'none'</code></a> Â»,
  return Â« <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-none"><code>'none'</code></a> Â».</p>
      <li data-md="">
       <p>If <var>effective A</var> is empty, return <var>effective B</var>.</p>
      <li data-md="">
       <p>If <var>effective B</var> is empty, return <var>effective A</var>.</p>
     </ol>
     <p>6   Let <var>schemes</var> be an empty <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set">set</a>.</p>
     <ol start="7">
      <li data-md="">
       <p>Let <var>intersection</var> be an empty <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#source-lists">source list</a>.</p>
      <li data-md="">
       <p>For each <var>expression B</var> in <var>effective B</var>:</p>
       <ol>
        <li data-md="">
         <p>If <var>expression B</var> matches the <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-source"><code>scheme-source</code></a> grammar and <var>expression B</var> is <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-contain">contained</a> in <var>effective A</var>, then <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append">append</a> <var>expression B</var> to <var>schemes</var>.</p>
         <p class="note" role="note"><span>Note:</span> Getting the <a data-link-type="dfn" href="#effective-source-list" id="ref-for-effective-source-list-3">effective source list</a> above means that tokens matching the <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-source"><code>scheme-source</code></a> grammar have already been normalized such that
  "<code>http:</code>"/"<code>ws:</code>" never appears without "<code>https:</code>"/"<code>ws:</code>" also appearing.</p>
       </ol>
      <li data-md="">
       <p>For each <var>expression</var> in <var>schemes</var>:</p>
       <ol>
        <li data-md="">
         <p>If <var>expression</var> does not match "<code>https:</code>" or <var>schemes</var> does not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-contain">contain</a> "<code>http:</code>":</p>
         <ol>
          <li data-md="">
           <p>If <var>expression</var> does not match "<code>wss:</code>" or <var>schemes</var> does not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-contain">contain</a> "<code>ws:</code>", <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append">append</a> <var>expression</var> to <var>intersection</var>.</p>
         </ol>
       </ol>
      <li data-md="">
       <p>For each <var>expression A</var> in <var>effective A</var>:</p>
       <ol>
        <li data-md="">
         <p>If <var>expression A</var> matches <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-source"><code>scheme-source</code></a> grammar
  and <var>schemes</var> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-contain">contains</a> <var>expression A</var>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue">continue</a>.</p>
        <li data-md="">
         <p>Let <var>match</var> be <code>null</code>.</p>
        <li data-md="">
         <p>For each <var>expression B</var> in <var>effective B</var>:</p>
         <ol>
          <li data-md="">
           <p>If at least one of <var>expression A</var> and <var>expression B</var> does not
  match <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-source"><code>scheme-source</code></a> or <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-host-source"><code>host-source</code></a> grammar:</p>
           <ol>
            <li data-md="">
             <p>If <var>expression A</var> matches <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-keyword-source"><code>keyword-source</code></a> grammar and is an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ascii-case-insensitive">ASCII case-insensitive</a> match for <var>expression B</var>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append">append</a> <var>expression A</var> to <var>intersection</var>.</p>
            <li data-md="">
             <p>If <var>expression A</var> matches <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-nonce-source"><code>nonce-source</code></a> or <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-hash-source"><code>hash-source</code></a> grammar and is a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#case-sensitive">case-sensitive</a> match for <var>expression B</var>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append">append</a> <var>expression A</var> to <var>intersection</var>.</p>
            <li data-md="">
             <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue">Continue</a> to the next <var>expression B</var>.</p>
           </ol>
          <li data-md="">
           <p>If <var>expression B</var>âs <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-part"><code>scheme-part</code></a> matches one of
  the elements in <var>schemes</var>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue">continue</a> to the
  next <var>expression B</var>.</p>
          <li data-md="">
           <p>If <var>expression A</var> matches <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-source"><code>scheme-source</code></a> grammar:</p>
           <ol>
            <li data-md="">
             <p>If <var>expression B</var> matches <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-host-source"><code>host-source</code></a> grammar
  and the result of executing <a href="#intersection-source-expressions">Â§4.2.1 What is an intersection of two expressions matching 
    scheme-source or host-source 
    grammar A and B?</a> is not <code>null</code> given <var>expression A</var> and <var>expression B</var>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append">append</a> the
  result to <var>intersection</var>.</p>
            <li data-md="">
             <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue">Continue</a> to the next <var>expression B</var>.</p>
           </ol>
          <li data-md="">
           <p>If the result of executing <a href="#subsume-source-list">Â§4.2.4 Does source list A subsume source listB given their
    respective origins and directive names?</a> is
  "<code>Subsumes</code>" given <var>expression B</var> and <var>expression A</var>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append">append</a> <var>expression A</var> to <var>intersection</var>. <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue">Continue</a> to the next <var>expression A</var>.</p>
          <li data-md="">
           <p>If the result of executing <a href="#intersection-source-expressions">Â§4.2.1 What is an intersection of two expressions matching 
    scheme-source or host-source 
    grammar A and B?</a> is
  not <code>null</code> given <var>expression A</var> and <var>expression B</var>, set <var>match</var> to
  the result.</p>
         </ol>
        <li data-md="">
         <p>If <var>match</var> is not <code>null</code>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append">append</a> <var>match</var> to <var>intersection</var>.</p>
       </ol>
      <li data-md="">
       <p>Return <var>intersection</var>.</p>
     </ol>
    </div>
    <div class="example" id="example-316ff315">
     <a class="self-link" href="#example-316ff315"></a> In these cases, <code>intersection</code> is an <a data-link-type="dfn" href="#source-expression-intersection" id="ref-for-source-expression-intersection-1">intersection</a> for <var>A</var> and <var>B</var>. 
<pre>A = wss: http://example.com
B = https: wss: 'none'
intersection = wss: https://example.com
</pre>
     <p>The expression "wss:" is present in both policies, so it is present in
    their intersection. Similarly, "http://example.com" is present in the
    intersection because it is the only expression subsumed by both
    "http://example.com" and "https:". Note that "'none'"" is ignored, as it is
    not the only token in <var>B</var>.</p>
<pre>A = http://*.a.com http://*.b.com
B = https://a.com:* http://*.c.com
intersection = https://a.com
</pre>
     <p>Only two sources are similar: "http://*.a.com" in <var>A</var> is similar to
    "https://a.com:*" in <var>B</var> so the intersection of the two source lists is
    "https://a.com".</p>
<pre>A = 'unsafe-inline' http://example.com:443/page1/html 'nonce-abc'
B = 'unsafe-inline' https://example.com:443/ 'strict-dynamic' 'nonce-abc'
intersection = 'nonce-abc'
</pre>
     <p>Since "<code>strict-dynamic</code>" honors only <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-nonce-source"><code>nonce-source</code></a> and <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-hash-source"><code>hash-source</code></a> expressions, <var>B</var> is effectively 
    "'strict-dynamic' 'nonce-abc'". That is why the intersection is 
    "'nonce-abc'".</p>
    </div>
    <h4 class="heading settled" data-level="3.1.4" id="intersection-helpers"><span class="secno">3.1.4. </span><span class="content">Intersection Helpers</span><a class="self-link" href="#intersection-helpers"></a></h4>
    <h5 class="heading settled" data-level="3.1.4.1" id="effective-directive"><span class="secno">3.1.4.1. </span><span class="content">Effective Directive Value</span><a class="self-link" href="#effective-directive"></a></h5>
    <div class="algorithm" data-algorithm="effective directive">
      Given a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string">string</a> (<var>name</var>) and a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#violation-policy">policy</a> (<var>policy</var>), the <dfn class="dfn-paneled" data-dfn-type="dfn" data-export="" data-lt="effective directive value" id="effective-directive-value">effective directive value for <var>name</var> and <var>policy</var></dfn> is the <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-value">value</a> resulting from running the following steps: 
     <ol>
      <li data-md="">
       <p>Switch on <var>name</var> and execute the associated steps:</p>
       <dl>
        <dt data-md="">"<code>child-src</code>"
        <dt data-md="">"<code>connect-src</code>"
        <dt data-md="">"<code>font-src</code>"
        <dt data-md="">"<code>img-src</code>"
        <dt data-md="">"<code>manifest-src</code>"
        <dt data-md="">"<code>media-src</code>"
        <dt data-md="">"<code>object-src</code>"
        <dt data-md="">"<code>script-src</code>"
        <dt data-md="">"<code>style-src</code>"
        <dd data-md="">
         <ol>
          <li data-md="">
           <p>If <var>policy</var>âs <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#policy-directive-set">directive set</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-contain">contains</a> a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directives">directive</a> whose <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-name">name</a> is <var>name</var>, return that <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directives">directive</a>âs <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-value">value</a>.</p>
          <li data-md="">
           <p>If <var>policy</var>âs <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#policy-directive-set">directive set</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-contain">contains</a> a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directives">directive</a> whose <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-name">name</a> is "<code>default-src</code>", return that <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directives">directive</a>âs <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-value">value</a>.</p>
          <li data-md="">
           <p>Return <code>null</code>.</p>
         </ol>
        <dt data-md="">"<code>frame-src</code>"
        <dt data-md="">"<code>worker-src</code>"
        <dd data-md="">
         <ol>
          <li data-md="">
           <p>If <var>policy</var>âs <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#policy-directive-set">directive set</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-contain">contains</a> a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directives">directive</a> whose <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-name">name</a> is <var>name</var>, return that <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directives">directive</a>âs <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-value">value</a>.</p>
          <li data-md="">
           <p>If <var>policy</var>âs <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#policy-directive-set">directive set</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-contain">contains</a> a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directives">directive</a> whose <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-name">name</a> is "<code>child-src</code>", return that <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directives">directive</a>âs <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-value">value</a>.</p>
          <li data-md="">
           <p>If <var>policy</var>âs <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#policy-directive-set">directive set</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-contain">contains</a> a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directives">directive</a> whose <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-name">name</a> is "<code>default-src</code>", return that <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directives">directive</a>âs <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-value">value</a>.</p>
          <li data-md="">
           <p>Return <code>null</code>.</p>
         </ol>
        <dt data-md="">"<code>base-uri</code>"
        <dt data-md="">"<code>block-all-mixed-content</code>"
        <dt data-md="">"<code>default-src</code>"
        <dt data-md="">"<code>frame-ancestors</code>"
        <dt data-md="">"<code>form-action</code>"
        <dt data-md="">"<code>plugin-types</code>"
        <dt data-md="">"<code>report-uri</code>"
        <dt data-md="">"<code>require-sri-for</code>"
        <dt data-md="">"<code>sandbox</code>"
        <dt data-md="">"<code>upgrade-insecure-requests</code>"
        <dd data-md="">
         <ol>
          <li data-md="">
           <p>If <var>policy</var>âs <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#policy-directive-set">directive set</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-contain">contains</a> a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directives">directive</a> whose <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-name">name</a> is <var>name</var>, return that <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directives">directive</a>âs <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-value">value</a>.</p>
          <li data-md="">
           <p>Return <code>null</code>.</p>
         </ol>
       </dl>
      <li data-md="">
       <p>Return <code>null</code>.</p>
     </ol>
    </div>
    <h5 class="heading settled" data-level="3.1.4.2" id="the-effective-source-list"><span class="secno">3.1.4.2. </span><span class="content">Effective Source List</span><a class="self-link" href="#the-effective-source-list"></a></h5>
    <div class="algorithm" data-algorithm="effective source list">
      Given a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#source-lists">source list</a> (<var>list</var>), a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string">string</a> (<var>name</var>), and an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin">origin</a> (<var>origin</var>), the <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="effective source list" data-noexport="" id="effective-source-list">effective source list for <var>list</var>, <var>name</var>, and <var>origin</var></dfn> is a simplification of <var>list</var> that expands complex tokens like <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-self"><code>'self'</code></a> and <a data-link-type="grammar" href="https://drafts.csswg.org/css-values-4/#mult-zero-plus"><code>*</code></a>, and removes ineffective, obviated, or invalid
    tokens (for instance, <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-unsafe-inline"><code>'unsafe-inline'</code></a> in the presence of a nonce). The result
    of running the following steps will generally be more verbose than <var>list</var>, but will be
    significantly simpler to compare: 
     <ol>
      <li data-md="">
       <p>If <var>list</var> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-is-empty">is empty</a> or Â« 'none' Â», return Â« 'none' Â».</p>
      <li data-md="">
       <p>Let <var>result</var> be an empty <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#source-lists">source list</a>.</p>
      <li data-md="">
       <p>For each <var>expression</var> in <var>list</var>:</p>
       <ol>
        <li data-md="">
         <p>If <var>expression</var> is "<a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-self"><code>'self'</code></a>":</p>
         <ol>
          <li data-md="">
           <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append">Append</a> the result of executing <a href="#rewrite-self">Â§4.2.2 Rewrite 'self' into a host-source expression for origin.</a> given <var>origin</var> to <var>result</var>.</p>
          <li data-md="">
           <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue">Continue</a>.</p>
         </ol>
        <li data-md="">
         <p>If <var>expression</var> matches the <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-keyword-source"><code>keyword-source</code></a> grammar, and <var>name</var> is not
  "<code>script-src</code>" or "<code>style-src</code>", <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue">continue</a>.</p>
        <li data-md="">
         <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue">Continue</a> if any of the following statements are true:</p>
         <ul>
          <li data-md="">
           <p><var>expression</var> is "<a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-none"><code>'none'</code></a>"</p>
          <li data-md="">
           <p><var>expression</var> is "<a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-strict-dynamic"><code>'strict-dynamic'</code></a>" and <var>name</var> is not "<code>script-src</code>"</p>
          <li data-md="">
           <p><var>expression</var> matches either the <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-nonce-source"><code>nonce-source</code></a> or <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-hash-source"><code>hash-source</code></a> grammar, and <var>name</var> is not "<code>script-src</code>" or
  "<code>style-src</code>"</p>
          <li data-md="">
           <p><var>expression</var> is "<a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-unsafe-inline"><code>'unsafe-inline'</code></a>", <var>name</var> is "<code>script-src</code>, and <var>list</var> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-contain">contains</a> one or more tokens that match one of the <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-nonce-source"><code>nonce-source</code></a> grammar, the <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-hash-source"><code>hash-source</code></a> grammar,
  or "<a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-strict-dynamic"><code>'strict-dynamic'</code></a>"</p>
          <li data-md="">
           <p><var>expression</var> matches either the <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-host-source"><code>host-source</code></a> or <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-source"><code>scheme-source</code></a> grammar, <var>name</var> is "<code>script-src</code>", amd <var>list</var> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-contain">contains</a> the token "<a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-strict-dynamic"><code>'strict-dynamic'</code></a>"</p>
          <li data-md="">
           <p><var>name</var> is "<code>plugin-types</code>", and <var>expression</var> does not match the <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-media-type"><code>media-type</code></a> grammar</p>
         </ul>
        <li data-md="">
         <p>If <var>expression</var> is the U+002A ASTERISK character (<code>*</code>):</p>
         <ol>
          <li data-md="">
           <p>For each <var>scheme</var> in Â« "<code>ftp:</code>", "<code>http:</code>", "<code>https:</code>", "<code>ws:</code>", "<code>wss:</code>" Â»:</p>
           <ol>
            <li data-md="">
             <p>Append <var>scheme</var> to <var>result</var>.</p>
           </ol>
          <li data-md="">
           <p>Append the concatenation of <var>origin</var>âs <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-scheme">scheme</a> and "<code>:</code>" to <var>result</var>.</p>
          <li data-md="">
           <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue">Continue</a>.</p>
         </ol>
        <li data-md="">
         <p>If <var>expression</var> matches the <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-source">scheme-source</a> grammar:</p>
         <ol>
          <li data-md="">
           <p>If <var>expression</var> is "<code>http:</code>", <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append">append</a> "<code>https:</code>" to <var>result</var>.</p>
          <li data-md="">
           <p>If <var>expression</var> is "<code>ws:</code>", <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append">append</a> "<code>wss:</code>" to <var>result</var>.</p>
         </ol>
        <li data-md="">
         <p>If <var>expression</var> matches the <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-host-source">host-source</a> grammar:</p>
         <ol>
          <li data-md="">
           <p>If <var>expression</var>âs <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-part">scheme-part</a> is "http", append the result of
  concatenating "https://", <var>expression</var>âs <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-host-part">host-part</a>, <var>expression</var>âs <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-port-part">port-part</a>, and <var>expression</var>âs <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-path-part">path-part</a> to <var>result</var>.</p>
          <li data-md="">
           <p>If <var>expression</var>âs <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-part">scheme-part</a> is "ws", append the result of
  concatenating "wss://", <var>expression</var>âs <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-host-part">host-part</a>, <var>expression</var>âs <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-port-part">port-part</a>, and <var>expression</var>âs <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-path-part">path-part</a> to <var>result</var>.</p>
         </ol>
        <li data-md="">
         <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append">Append</a> <var>expression</var> to <var>result</var>.</p>
       </ol>
      <li data-md="">
       <p>If <var>result</var> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-is-empty">is empty</a> or Â« 'strict-dynamic' Â», return Â« 'none' Â».</p>
      <li data-md="">
       <p>Return <var>result</var>.</p>
     </ol>
    </div>
    <div class="example" id="example-6fcc3834">
     <a class="self-link" href="#example-6fcc3834"></a> 
     <p>For any directive with origin <code>https://example.test/</code>:</p>
<pre>https: wss: 'none' 'self'
</pre>
     <p>The effective source list is "http: wss: https://example.test/". Note that
    "'none'" is not part of the effective source list because it has no effect
    when it is not the only source.</p>
     <p>For "<code>style-src</code>":</p>
<pre>http://example.com 'strict-dynamic' 'nonce-abc'
</pre>
     <p>The effective source list is "http://example.com 'nonce-abc'" since
    "'strict-dynamic'" is ignored in non-"<code>script-src</code>" directives.</p>
     <p>For "<code>script-src</code>":</p>
<pre>http://example.com 'strict-dynamic' 'nonce-abc'
</pre>
     <p>The effective source list is "'strict-dynamic' 'nonce-abc'" since
    "'strict-dynamic'" in "<code>script-src</code>" case does not honor host and scheme
    source expressions.</p>
    </div>
    <h5 class="heading settled" data-level="3.1.4.3" id="similarity-source-expressions"><span class="secno">3.1.4.3. </span><span class="content">Source Expression Similarity</span><a class="self-link" href="#similarity-source-expressions"></a></h5>
    <div class="algorithm" data-algorithm="similarity of two source expressions">
      Given two source expressions (<var>A</var> and <var>B</var>), the <dfn class="dfn-paneled" data-dfn-type="abstract-op" data-export="" data-lt="similarity of two source expressions" id="abstract-opdef-similarity-of-two-source-expressions"> similaratiy</dfn> of <var>A</var> and <var>B</var> indicates whether the two expressions are <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#case-sensitive">case-sensitive</a> matches or in the case of <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-source"><code>scheme-source</code></a>, <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-host-source"><code>host-source</code></a> expressions,
    if their individual parts match (that is <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-part"><code>scheme-part</code></a>, <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-host-part"><code>host-part</code></a>, <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-port-part"><code>port-part</code></a>, and <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-path-part"><code>path-part</code></a>). 
     <p class="note" role="note"><span>NOTE:</span> This property is symmetric. That is if <var>A</var> is <a data-link-type="abstract-op" href="#abstract-opdef-similarity-of-two-source-expressions" id="ref-for-abstract-opdef-similarity-of-two-source-expressions-1">similar</a> to <var>B</var>, 
    it must be that <var>B</var> is <a data-link-type="abstract-op" href="#abstract-opdef-similarity-of-two-source-expressions" id="ref-for-abstract-opdef-similarity-of-two-source-expressions-2">similar</a> to <var>A</var>.</p>
     <p>A <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#source-expression">source expression</a> has a <dfn class="dfn-paneled" data-dfn-for="source expression" data-dfn-type="dfn" data-noexport="" id="source-expression-wildcard-host">wildcard host</dfn> if the first character of the <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#source-expression">source expression</a>âs <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-host-part"><code>host-part</code></a> is an U+002A ASTERISK 
    character (<code>*</code>).</p>
     <p>A <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#source-expression">source expression</a> has a <dfn class="dfn-paneled" data-dfn-for="source expression" data-dfn-type="dfn" data-noexport="" id="source-expression-wildcard-port">wildcard port</dfn> if the <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-port-part"><code>port-part</code></a> of the <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#source-expression">source expression</a> is an U+002A 
    ASTERISK character (<code>*</code>).</p>
     <ol>
      <li data-md="">
       <p>If <var>A</var>âs grammar does not match <var>B</var>âs grammar, return "<code>Not Similar</code>".</p>
      <li data-md="">
       <p>If <var>A</var> matches the <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-keyword-source"><code>keyword-source</code></a>, <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-nonce-source"><code>nonce-source</code></a>,
  or <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-hash-source"><code>hash-source</code></a> grammar:</p>
       <ol>
        <li data-md="">
         <p>If <var>A</var> is a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#case-sensitive">case-sensitive</a> match to <var>B</var>, return "<code>Similar</code>".</p>
        <li data-md="">
         <p>Return "<code>Not Similar</code>".</p>
       </ol>
      <li data-md="">
       <p>Let <var>scheme A</var> be <var>A</var>âs <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-part"><code>scheme-part</code></a>, if present, and <code>null</code> otherwise.</p>
      <li data-md="">
       <p>Let <var>scheme B</var> be <var>B</var>âs <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-part"><code>scheme-part</code></a>, if present, and <code>null</code> otherwise.</p>
      <li data-md="">
       <p>If the result of executing <a href="https://www.w3.org/TR/CSP3/#match-schemes">Content Security Policy Level 3 Â§match-schemes</a> returns
  "<code>Does Not Match</code>" given <var>scheme A</var> and <var>scheme B</var>, and the result of 
  executing <a href="https://www.w3.org/TR/CSP3/#match-schemes">Content Security Policy Level 3 Â§match-schemes</a> on <var>scheme B</var> and <var>scheme A</var> is 
  "<code>Does Not Match</code>", return "<code>Not Similar</code>".</p>
      <li data-md="">
       <p>If <var>A</var> or <var>B</var> matches <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-source"><code>scheme-source</code></a> grammar,
  return "<code>Similar</code>".</p>
      <li data-md="">
       <p>Return "<code>Not Similar</code>" if any of the following is true:</p>
       <ol>
        <li data-md="">
         <p>Let <var>host A</var> be <var>A</var>âs <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-host-part"><code>host-part</code></a>, if present, and <code>null</code> otherwise.</p>
        <li data-md="">
         <p>Let <var>host B</var> be <var>B</var>âs <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-host-part"><code>host-part</code></a>, if present, and <code>null</code> otherwise.</p>
        <li data-md="">
         <p>Both <var>A</var> and <var>B</var> have a <a data-link-type="dfn" href="#source-expression-wildcard-host" id="ref-for-source-expression-wildcard-host-1">wildcard host</a>,
  but <var>host A</var> is not an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ascii-case-insensitive">ASCII case-insensitive</a> match to <var>host B</var>.</p>
        <li data-md="">
         <p>At most one of <var>A</var> and <var>B</var> has a <a data-link-type="dfn" href="#source-expression-wildcard-host" id="ref-for-source-expression-wildcard-host-2">wildcard host</a>, the result of executing <a href="https://www.w3.org/TR/CSP3/#match-hosts">Content Security Policy Level 3 Â§match-hosts</a> is "<code>Does Not Match</code>" given <var>host A</var> and <var>host B</var>, and the result of executing <a href="https://www.w3.org/TR/CSP3/#match-hosts">Content Security Policy Level 3 Â§match-hosts</a> on <var>host B</var> and <var>host A</var> is also "<code>Does Not Match</code>".</p>
        <li data-md="">
         <p>Let <var>port A</var> be <var>A</var>âs <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-port-part"><code>port-part</code></a>, if present, and <code>null</code> otherwise.</p>
        <li data-md="">
         <p>Let <var>port B</var> be <var>B</var>âs <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-port-part"><code>port-part</code></a>, if present, and <code>null</code> otherwise.</p>
        <li data-md="">
         <p>Neither <var>A</var> nor <var>B</var> has a <a data-link-type="dfn" href="#source-expression-wildcard-port" id="ref-for-source-expression-wildcard-port-1">wildcard port</a>,
  the result of executing <a href="https://www.w3.org/TR/CSP3/#match-ports">Content Security Policy Level 3 Â§match-ports</a> is "<code>Does Not Match</code>"
  given <var>port A</var> and <var>port B</var>, and the result of executing <a href="https://www.w3.org/TR/CSP3/#match-ports">Content Security Policy Level 3 Â§match-ports</a> given <var>port B</var> and <var>port A</var> is also 
  "<code>Does Not Match</code>".</p>
        <li data-md="">
         <p>Let <var>path A</var> be <var>A</var>âs <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-path-part"><code>path-part</code></a>, if present, and <code>null</code> otherwise.</p>
        <li data-md="">
         <p>Let <var>path B</var> be <var>B</var>âs <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-path-part"><code>path-part</code></a>, if present, and <code>null</code> otherwise.</p>
        <li data-md="">
         <p>The result of executing <a href="https://www.w3.org/TR/CSP3/#match-paths">Content Security Policy Level 3 Â§match-paths</a> is "<code>Does Not Match</code>"
   given <var>path A</var> and <var>path B</var> and the result of executing <a href="https://www.w3.org/TR/CSP3/#match-paths">Content Security Policy Level 3 Â§match-paths</a> given <var>path B</var> and <var>path A</var> is also 
   "<code>Does Not Match</code>".</p>
       </ol>
      <li data-md="">
       <p>Return "<code>Similar</code>".</p>
     </ol>
    </div>
    <div class="example" id="example-5b890e15">
     <a class="self-link" href="#example-5b890e15"></a> Cases when <var>A</var> is <a data-link-type="abstract-op" href="#abstract-opdef-similarity-of-two-source-expressions" id="ref-for-abstract-opdef-similarity-of-two-source-expressions-3">similar</a> to <var>B</var>. 
<pre>A = 'nonce-ch4hvvbHDpv7xCSvXCs3BrNggHdTzxUA'
B = 'nonce-ch4hvvbHDpv7xCSvXCs3BrNggHdTzxUA'
</pre>
     <p>Since both <var>A</var> and <var>B</var> match the <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-nonce-source"><code>nonce-source</code></a> grammar and <var>A</var> is a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#case-sensitive">case-sensitive</a> match for <var>B</var>, <var>A</var> is similar to <var>B</var>.</p>
<pre>A = https://inner.example.com/foo/
B = http://*.example.com/foo/bar/
</pre>
     <p>Since <var>A</var> has a <a data-link-type="dfn" href="#source-expression-wildcard-host" id="ref-for-source-expression-wildcard-host-3">wildcard host</a>, it matches any
    subdomain which in this case is "inner" so that <var>A</var> is similar to <var>B</var>.</p>
<pre>A = http://*.example.com
B = https://example.com:*
</pre>
     <p>Even though <var>A</var> and <var>B</var>âs ports are different, <var>A</var> and <var>B</var> are similar
    because "http" matches both "http" and a more secure variant "https".</p>
<pre>A = http://example.com:80/page1/html
B = https://example.com:443/
</pre>
     <p>In both sources specified ports are defalt ports for the respective schemes
    and <var>B</var>âs path would match any path, <var>A</var> is similar to <var>B</var>.</p>
     <p>Cases when <var>A</var> is not <a data-link-type="abstract-op" href="#abstract-opdef-similarity-of-two-source-expressions" id="ref-for-abstract-opdef-similarity-of-two-source-expressions-4">similar</a> to <var>B</var>.</p>
<pre>A = 'sha256-abc123'
B = 'sha512-cde456'
</pre>
     <p>Even though both <var>A</var> and <var>B</var> match the <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-hash-source"><code>hash-source</code></a> grammar, <var>A</var> is not a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#case-sensitive">case-sensitive</a> match for <var>B</var>.</p>
<pre>A = http://example.com:80
B = http://example.com:334
</pre>
     <p>In this case, ports of <var>A</var> and <var>B</var> do not match so that the two sources are
    not similar .</p>
<pre>A = http://example.com/page.html
B = http://example.com/index.html
</pre>
     <p>The two sources are not similar because their paths do not match.</p>
    </div>
    <p class="issue" id="issue-b43dcb1b"><a class="self-link" href="#issue-b43dcb1b"></a> Move the remaining intersection algorithms into this section.</p>
    <h3 class="heading settled" data-level="3.2" id="subsumption"><span class="secno">3.2. </span><span class="content">Subsumption</span><a class="self-link" href="#subsumption"></a></h3>
    <p class="issue" id="issue-94e5cca5"><a class="self-link" href="#issue-94e5cca5"></a> Move all the subsumption algorithms into this section.</p>
   </section>
   <section>
    <h2 class="heading settled" data-level="4" id="algorithms"><span class="secno">4. </span><span class="content">Algorithms</span><a class="self-link" href="#algorithms"></a></h2>
    <h3 class="heading settled algorithm" data-algorithm="Is response to request blocked by contextâs required CSP?" data-level="4.1" id="process-response"><span class="secno">4.1. </span><span class="content"> Is <var>response</var> to <var>request</var> blocked by <var>context</var>âs required CSP? </span><a class="self-link" href="#process-response"></a></h3>
    <p>Given a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response">response</a> (<var>response</var>), a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request">request</a> (<var>request</var>), and a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#browsing-context">browsing context</a> (<var>context</var>), this algorithm returns "<code>Allowed</code>" or
  "<code>Blocked</code>" as appropriate:</p>
    <ol class="algorithm">
     <li data-md="">
      <p>Return "<code>Allowed</code>" if either of the following is true:</p>
      <ol>
       <li data-md="">
        <p><var>context</var> is not a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#nested-browsing-context">nested browsing context</a>.</p>
       <li data-md="">
        <p><var>context</var>âs <a data-link-type="dfn" href="#browsing-context-required-csp" id="ref-for-browsing-context-required-csp-10">required CSP</a> is <code>null</code>.</p>
      </ol>
     <li data-md="">
      <p>Let <var>required policy</var> be the result of executing <a href="https://www.w3.org/TR/CSP3/#parse-serialized-policy">Content Security Policy Level 3 Â§parse-serialized-policy</a> on <var>context</var>âs <a data-link-type="dfn" href="#browsing-context-required-csp" id="ref-for-browsing-context-required-csp-11">required CSP</a> and
  "<code>enforce</code>".</p>
     <li data-md="">
      <p>If the <a href="#origin-allowed">Â§4.2 Does response allow blanket enforcment of policy from request?</a> algorithm returns "<code>Allowed</code>" when executed upon <var>response</var> and <var>request</var>:</p>
      <ol>
       <li data-md="">
        <p>Append <var>required policy</var> to <var>response</var>âs <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-csp-list">CSP
  list</a>.</p>
       <li data-md="">
        <p>Return "<code>Allowed</code>".</p>
      </ol>
     <li data-md="">
      <p class="assertion">Assert: <var>context</var> is a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#nested-browsing-context">nested browsing context</a>, and <var>response</var> is
  a cross-origin, <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#network-scheme">network schemed</a> resource.</p>
     <li data-md="">
      <p>If the <a href="#subsume-policy-list">Â§4.3 Does subsuming policy subsume policy list given their respective
    origins?</a> algorithm returns "<code>Subsumes</code>" when
  executed upon <var>required policy</var>, <var>request</var>âs <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-origin">origin</a>, <var>response</var>âs <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-csp-list">CSP list</a>, and <var>response</var>âs <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-url">url</a>âs <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-origin">origin</a>, return "<code>Allowed</code>".</p>
     <li data-md="">
      <p>Return "<code>Blocked</code>".</p>
    </ol>
    <h3 class="heading settled algorithm" data-algorithm="Does response allow blanket enforcment of policy from request?" data-level="4.2" id="origin-allowed"><span class="secno">4.2. </span><span class="content"> Does <var>response</var> allow blanket enforcment of policy from <var>request</var>? </span><a class="self-link" href="#origin-allowed"></a></h3>
    <p>Given a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response">response</a> (<var>response</var>), and a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request">request</a> (<var>request</var>), this
  algorithm returns "<code>Allowed</code>" if the former allows the latter to enforce
  arbitrary policy, and "<code>Not Allowed</code>" otherwise:</p>
    <ol>
     <li data-md="">
      <p>If <var>response</var>âs <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-url">url</a>âs <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-scheme">scheme</a> is
  a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#local-scheme">local scheme</a>, return "<code>Allowed</code>".</p>
      <p class="note" role="note"><span>Note:</span> The embedder has direct access to same-origin responses, so if it
  wishes to enforce a policy on that same-origin response, we simply do so.</p>
     <li data-md="">
      <p>If <var>response</var>âs <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-url">url</a>âs <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-origin">origin</a> is the
  same as <var>request</var>âs <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-origin">origin</a>, return "<code>Allowed</code>".</p>
      <p class="note" role="note"><span>Note:</span> Likewise, <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#local-scheme">local scheme</a> responses already inherit their policy
  from the embedder, so we allow the embedder to tighten that policy via this
  embedding mechanism.</p>
     <li data-md="">
      <p>If <var>response</var>âs <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-header-list">header list</a> has a header named <a data-link-type="http-header" href="#http-headerdef-allow-csp-from" id="ref-for-http-headerdef-allow-csp-from-7"><code>Allow-CSP-From</code></a> (<var>header</var>):</p>
      <ol>
       <li data-md="">
        <p>If <var>header</var>âs value is "<code>*</code>", return "<code>Allowed</code>".</p>
       <li data-md="">
        <p>If <var>request</var>âs <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-origin">origin</a>, <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#ascii-serialisation-of-an-origin">serialized</a> and <a data-link-type="dfn" href="https://encoding.spec.whatwg.org/#utf-8-encode">UTF-8
  encoded</a> is <var>header</var>âs value, return "<code>Allowed</code>".</p>
      </ol>
     <li data-md="">
      <p>Return "<code>Not Allowed</code>".</p>
    </ol>
    <h4 class="heading settled algorithm" data-algorithm="What is an intersection of two expressions matching 
    scheme-source or host-source 
    grammar A and B?" data-level="4.2.1" id="intersection-source-expressions"><span class="secno">4.2.1. </span><span class="content"> What is an intersection of two expressions matching <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-source"><code>scheme-source</code></a> or <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-host-source"><code>host-source</code></a> grammar <var>A</var> and <var>B</var>? </span><a class="self-link" href="#intersection-source-expressions"></a></h4>
    <p><a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#source-expression">Source expression</a> is said to be an <dfn class="dfn-paneled" data-dfn-for="source expression" data-dfn-type="dfn" data-noexport="" id="source-expression-intersection">intersection</dfn> of two other 
  expressions matching <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-source"><code>scheme-source</code></a> or <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-host-source"><code>host-source</code></a> grammar <var>A</var> and <var>B</var> if it contains the more
  restrictive <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-part"><code>scheme-part</code></a>, <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-host-part"><code>host-part</code></a>, <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-port-part"><code>port-part</code></a>, and <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-path-part"><code>path-part</code></a> of the two.</p>
    <div class="example" id="example-b7889eb8">
     <a class="self-link" href="#example-b7889eb8"></a> In these cases, <code>Intersect</code> is an <a data-link-type="dfn" href="#source-expression-intersection" id="ref-for-source-expression-intersection-2">intersection</a> for <var>A</var> and <var>B</var>. 
<pre>A = https:
B = http:
Intersect = https:
</pre>
<pre>A = http://*.example.com
B = https://example.com:*
Intersect = https://example.com:443
</pre>
<pre>A = http://example.com:80/page1/html
B = https://example.com:443/
Intersect = https://example.com:443/page1/html
</pre>
<pre>A = https:
B = http://example.com
Intersect = <code>https://example.com</code>.
</pre>
<pre>A = https://example.com:*
B = http://*.example.com/page.html
Intersect = <code>https://example.com/page.html</code>
</pre>
    </div>
    <p>Given two expressions matching the <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-source"><code>scheme-source</code></a> or <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-host-source"><code>host-source</code></a> grammar (<var>A</var> and <var>B</var>), return their <a data-link-type="dfn" href="#source-expression-intersection" id="ref-for-source-expression-intersection-3">intersection</a> if <var>A</var> is <a data-link-type="abstract-op" href="#abstract-opdef-similarity-of-two-source-expressions" id="ref-for-abstract-opdef-similarity-of-two-source-expressions-5">similar</a> to <var>B</var>. Otherwise, return <code>null</code>.</p>
    <ol>
     <li data-md="">
      <p>If the result of executing <a href="#similarity-source-expressions">Â§3.1.4.3 Source Expression Similarity</a> on <var>A</var> and <var>B</var> is "<code>Not Similar</code>", return <code>null</code>.</p>
     <li data-md="">
      <p>Let <var>source</var> be an empty string.</p>
     <li data-md="">
      <p>Let <var>scheme A</var> be <var>A</var>âs <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-part"><code>scheme-part</code></a>, if present, and <code>null</code> otherwise.</p>
     <li data-md="">
      <p>Let <var>scheme B</var> be <var>B</var>âs <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-part"><code>scheme-part</code></a>, if present, and <code>null</code> otherwise.</p>
     <li data-md="">
      <p>Let <var>more secure scheme B</var> be <code>true</code> if the result of executing <a href="https://www.w3.org/TR/CSP3/#match-schemes">Content Security Policy Level 3 Â§match-schemes</a> is "<code>Does Not match</code>" given <var>scheme A</var> and <var>scheme B</var>, and <code>false</code> otherwise.</p>
     <li data-md="">
      <p>Append <var>scheme A</var> and ":" to <var>source</var> if <var>scheme A</var> is not <code>null</code> and <var>more secure scheme B</var> is <code>false</code>. Otherwise, append <var>scheme B</var> and ":"
  to <var>source</var> if <var>scheme B</var> is not <code>null</code>.</p>
     <li data-md="">
      <p>If both <var>A</var> and <var>B</var> match the <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-source"><code>scheme-source</code></a> grammar,
  return <var>source</var>.</p>
     <li data-md="">
      <p>Append "//" to <var>source</var> if it is not empty.</p>
     <li data-md="">
      <p>Let <var>host A</var> be <var>A</var>âs <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-host-part"><code>host-part</code></a>, if present, and <code>null</code> otherwise.</p>
     <li data-md="">
      <p>Let <var>host B</var> be <var>B</var>âs <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-host-part"><code>host-part</code></a>, if present, and <code>null</code> otherwise.</p>
     <li data-md="">
      <p>If <var>host A</var> is not <code>null</code>:</p>
      <ol>
       <li data-md="">
        <p>If <var>host B</var> is <code>null</code>, append <var>host A</var> to <var>source</var>.
   Continue to the next step in the main algorithm.</p>
       <li data-md="">
        <p>If <var>A</var> doesnât match the <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-source"><code>scheme-source</code></a> grammar and
   doesnât have a <a data-link-type="dfn" href="#source-expression-wildcard-host" id="ref-for-source-expression-wildcard-host-4">wildcard host</a>, append <var>host A</var> to <var>source</var>.</p>
       <li data-md="">
        <p>Otherwise, append <var>host B</var> to <var>source</var>.</p>
      </ol>
     <li data-md="">
      <p>If <var>host A</var> is <code>null</code>, append <var>host B</var> to <var>source</var>.</p>
     <li data-md="">
      <p>Let <var>port A</var> be <var>A</var>âs <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-port-part"><code>port-part</code></a>, if present, and <code>null</code> otherwise.</p>
     <li data-md="">
      <p>Let <var>port B</var> be <var>B</var>âs <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-port-part"><code>port-part</code></a>, if present, and <code>null</code> otherwise.</p>
     <li data-md="">
      <p>If <var>port A</var> is <code>null</code>, append ":" and <var>port B</var> to <var>source</var> if it is
   not <code>null</code>.</p>
     <li data-md="">
      <p>If <var>port A</var> is not <code>null</code>:</p>
      <ol>
       <li data-md="">
        <p>If <var>port B</var> is <code>null</code>, append ":" and <var>port A</var> to <var>source</var>.
   Continue to the next step in the main algorithm.</p>
       <li data-md="">
        <p>If <var>A</var> doesnât have a <a data-link-type="dfn" href="#source-expression-wildcard-port" id="ref-for-source-expression-wildcard-port-2">wildcard port</a> and <var>more secure scheme B</var> is <code>false</code>, append ":" and <var>port A</var> to <var>source</var>.</p>
       <li data-md="">
        <p>Otherwise, append ":" and <var>port B</var> to <var>source</var>.</p>
      </ol>
     <li data-md="">
      <p>Let <var>path A</var> be <var>A</var>âs <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-path-part"><code>path-part</code></a>, if present, and <code>null</code> otherwise.</p>
     <li data-md="">
      <p>Let <var>path B</var> be <var>B</var>âs <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-path-part"><code>path-part</code></a>, if present, and <code>null</code> otherwise.</p>
     <li data-md="">
      <p>If <var>path A</var> is <code>null</code>, append <var>path B</var> to <var>source</var> if it is not <code>null</code>.</p>
     <li data-md="">
      <p>If <var>path A</var> is not <code>null</code>:</p>
      <ol>
       <li data-md="">
        <p>If <var>path B</var> is <code>null</code>, append <var>path A</var> to <var>source</var>.
   Continue to the next step in the main algorithm.</p>
       <li data-md="">
        <p>If the result of executing <a href="https://www.w3.org/TR/CSP3/#match-paths">Content Security Policy Level 3 Â§match-paths</a> on <var>path A</var> and <var>path B</var> is "<code>Does Not Match</code>", append <var>path A</var> to <var>source</var>.</p>
       <li data-md="">
        <p>Otherwise, append <var>path B</var> to <var>source</var>.</p>
      </ol>
     <li data-md="">
      <p>Return <var>source</var>.</p>
    </ol>
    <h4 class="heading settled algorithm" data-algorithm="Rewrite &apos;self&apos; into a host-source expression for origin." data-level="4.2.2" id="rewrite-self"><span class="secno">4.2.2. </span><span class="content"> Rewrite <code>'self'</code> into a host-source expression for <var>origin</var>. </span><a class="self-link" href="#rewrite-self"></a></h4>
    <p>Given an origin (<var>origin</var>), this algorithm returns a <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-host-source"><code>host-source</code></a> expression that has the same effect
  as <code>'self'</code> for that origin:</p>
    <ol>
     <li data-md="">
      <p>If <var>origin</var> is an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-opaque">opaque origin</a>, return the empty string.</p>
     <li data-md="">
      <p>Return the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#ascii-serialisation-of-an-origin">ASCII
  serialization</a> of <var>origin</var>.</p>
    </ol>
    <h4 class="heading settled algorithm" data-algorithm="Does source expression A subsume source expression B?" data-level="4.2.3" id="subsume-source-expressions"><span class="secno">4.2.3. </span><span class="content"> Does <code>source expression</code> <var>A</var> subsume <code>source expression</code> <var>B</var>? </span><a class="self-link" href="#subsume-source-expressions"></a></h4>
    <p>Given two <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#source-expression">source expressions</a> <var>A</var> and <var>B</var>, this algorithm returns
  "<code>Subsumes</code>" if <var>A</var> <a data-link-type="dfn" href="#policy-subsume" id="ref-for-policy-subsume-5">subsumes</a> <var>B</var>, and returns
  "<code>Does Not Subsume</code>" otherwise.</p>
    <ol>
     <li data-md="">
      <p class="assertion">Assert: Neither <var>A</var> nor <var>B</var> match the <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-keyword-source"><code>keyword-source</code></a> grammar.</p>
     <li data-md="">
      <p>If both <var>A</var> and <var>B</var> match either <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-host-source"><code>host-source</code></a> or <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-source"><code>scheme-source</code></a> grammar:</p>
      <ol>
       <li data-md="">
        <p>If <a href="https://www.w3.org/TR/CSP3/#match-schemes">Content Security Policy Level 3 Â§match-schemes</a> returns "<code>Does Not Match</code>" given <var>A</var>âs <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-part"><code>scheme-part</code></a> (or <code>null</code> if <var>A</var> does not contain a <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-part"><code>scheme-part</code></a>) and <var>B</var>âs <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-part"><code>scheme-part</code></a> (or <code>null</code> if <var>B</var> does not contain a <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-part"><code>scheme-part</code></a>), 
  return "<code>Does Not Subsume</code>".</p>
       <li data-md="">
        <p>If <var>A</var> or <var>B</var> matches the <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-source"><code>scheme-source</code></a> grammar:</p>
        <ol>
         <li data-md="">
          <p>If <var>A</var> matches the <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-source"><code>scheme-source</code></a> grammar, return
  "<code>Subsumes</code>". Otherwise, return "<code>Does Not Subsume</code>".</p>
        </ol>
       <li data-md="">
        <p>If <var>B</var> has a <code>wildcard host</code>:</p>
        <ol>
         <li data-md="">
          <p>If <var>A</var> doesnât have a <code>wildcard host</code>, return "<code>Does not Subsume</code>".</p>
         <li data-md="">
          <p>Let <var>remaining host B</var> be the result of removing the leading
  ("*.") from <var>B</var>âs <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-host-part"><code>host-part</code></a>.</p>
         <li data-md="">
          <p>If <a href="https://www.w3.org/TR/CSP3/#match-hosts">Content Security Policy Level 3 Â§match-hosts</a> returns "<code>Does Not Match</code>" given <var>A</var>âs <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-host-part"><code>host-part</code></a> and <var>remaining host B</var>, return 
  "<code>Does Not Subsume</code>".</p>
        </ol>
       <li data-md="">
        <p>If <var>B</var> doesnât have a <code>wildcard host</code> and <a href="https://www.w3.org/TR/CSP3/#match-hosts">Content Security Policy Level 3 Â§match-hosts</a> returns
  "<code>Does Not Match</code>" given <var>A</var>âs <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-host-part"><code>host-part</code></a> and <var>B</var>âs <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-host-part"><code>host-part</code></a>, return "<code>Does Not Subsume</code>".</p>
       <li data-md="">
        <p>If <var>A</var> has a <code>wildcard port</code> but <var>B</var> doesnât have a <code>wildcard port</code>,
  return "<code>Does Not Subsume</code>".</p>
       <li data-md="">
        <p>If <var>A</var> doesnât have a <code>wildcard port</code> and <a href="https://www.w3.org/TR/CSP3/#match-ports">Content Security Policy Level 3 Â§match-ports</a> returns
  "<code>Does Not Match</code>" given <var>A</var>âs <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-port-part"><code>port-part</code></a> (or <code>null</code> if <var>A</var> does not contain a <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-port-part"><code>port-part</code></a>)
  and <var>B</var>âs <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-port-part"><code>port-part</code></a> (or <code>null</code> if <var>B</var> does not 
  contain a <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-port-part"><code>port-part</code></a>), return "<code>Does Not Subsume</code>".</p>
       <li data-md="">
        <p>If <a href="https://www.w3.org/TR/CSP3/#match-paths">Content Security Policy Level 3 Â§match-paths</a> returns "<code>Does Not Match</code>" given <var>A</var>âs <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-path-part"><code>path-part</code></a> (or <code>null</code> if <var>A</var> does not contain a <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-path-part"><code>path-part</code></a>) and <var>B</var>âs <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-path-part"><code>path-part</code></a> (or <code>null</code> if <var>B</var> does not contain a <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-path-part"><code>path-part</code></a>), return 
  "<code>Does Not Subsume</code>".</p>
       <li data-md="">
        <p>Return "<code>Subsumes</code>".</p>
      </ol>
     <li data-md="">
      <p>If both <var>A</var> and <var>B</var> match the <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-hash-source"><code>hash-source</code></a> grammar:</p>
      <ol>
       <li data-md="">
        <p>If <var>A</var> is a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#case-sensitive">case-sensitive</a> match to <var>B</var>, return "<code>Subsumes</code>".
  Otherwise, return "<code>Does Not Subsume</code>".</p>
      </ol>
     <li data-md="">
      <p>If both <var>A</var> and <var>B</var> match the <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-nonce-source"><code>nonce-source</code></a> grammar:</p>
      <ol>
       <li data-md="">
        <p>Return "<code>Subsumes</code>".</p>
      </ol>
      <p class="note" role="note"><span>Note:</span> Nonce source matching is value-agnostic to prevent a malicious
  embedder from brute forcing the nonce value with an attack as
  described in <a href="#policy-leakage">Â§5.2 Policy Leakage</a></p>
     <li data-md="">
      <p>Return "<code>Does Not Subsume</code>".</p>
    </ol>
    <h4 class="heading settled algorithm" data-algorithm="Does source list A subsume source listB given their
    respective origins and directive names?" data-level="4.2.4" id="subsume-source-list"><span class="secno">4.2.4. </span><span class="content"> Does <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#source-lists">source list</a> <var>A</var> subsume <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#source-lists">source list</a><var>B</var> given their
    respective <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-origin">origins</a> and directive names? </span><a class="self-link" href="#subsume-source-list"></a></h4>
    <p>Given a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#source-lists">source list</a> <var>A</var> with an <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-origin">origin</a> (<var>origin A</var>) and a string (<var>directive A</var>), <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#source-lists">source list</a> <var>B</var> with an <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-origin">origin</a> (<var>origin B</var>) and a string (<var>directive B</var>), this
  algorithm returns "<code>Subsumes</code>" if <var>A</var> <a data-link-type="dfn" href="#policy-subsume" id="ref-for-policy-subsume-6">subsumes</a> <var>B</var>, and
  returns "<code>Does Not Subsume</code>" otherwise.</p>
    <p>A <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directives">directive</a> <dfn class="dfn-paneled" data-dfn-for="directive" data-dfn-type="dfn" data-noexport="" id="directive-contains">contains</dfn> a given <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#source-expression">source expression</a> if the expression is <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-contain">contained</a> by
  its <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-value">value</a>.</p>
    <ol>
     <li data-md="">
      <p>If <var>directive A</var> is not an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ascii-case-insensitive">ASCII case-insensitive</a> match to <var>directive B</var>, return "<code>Does Not Subsume</code>".</p>
     <li data-md="">
      <p>If <var>A</var> is empty or <var>B</var> is <code>none</code>, return "<code>Subsumes</code>".</p>
     <li data-md="">
      <p>If <var>B</var> is empty or <var>A</var> is <code>none</code>, return "<code>Does Not Subsume</code>".</p>
     <li data-md="">
      <p>If <var>directive B</var> is "<code>script-src</code>" and <var>B</var> <a data-link-type="dfn" href="#directive-contains" id="ref-for-directive-contains-1">contains</a> a <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-keyword-source"><code>keyword-source</code></a> expression "<code>strict-dynamic</code>" but <var>A</var> does not contain it, return "<code>Does Not Subsume</code>".</p>
     <li data-md="">
      <p>If <var>directive B</var> is "<code>script-src</code>" or "<code>style-src</code>":</p>
      <ol>
       <li data-md="">
        <p>If <var>B</var> <a data-link-type="dfn" href="#directive-contains" id="ref-for-directive-contains-2">contains</a> a <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-keyword-source"><code>keyword-source</code></a> expression "<code>unsafe-eval</code>" but <var>A</var> does not contain it, return "<code>Does Not Subsume</code>".</p>
       <li data-md="">
        <p>If <var>B</var> <a data-link-type="dfn" href="#directive-contains" id="ref-for-directive-contains-3">contains</a> a <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-keyword-source"><code>keyword-source</code></a> expression
  "<code>unsafe-hashed-attributes</code>" but <var>A</var> does not contain it, return
  "<code>Does Not Subsume</code>".</p>
       <li data-md="">
        <p>Let <var>type B</var> be "<code>script</code>" if <var>directive B</var> is "<code>script-src</code>" and
  "<code>style</code>" otherwise. Similarly, let <var>type A</var> be "<code>script</code>" if <var>directive A</var> is "<code>script-src</code>" and "<code>style</code>" otherwise.</p>
       <li data-md="">
        <p>If <a href="https://www.w3.org/TR/CSP3/#allow-all-inline">Content Security Policy Level 3 Â§allow-all-inline</a> returns "<code>Allows</code>" given <var>B</var> with <var>type B</var>, but returns "<code>Does Not Allow</code>" given <var>A</var> with <var>type A</var>, return "<code>Does Not Subsume</code>".</p>
      </ol>
     <li data-md="">
      <p>Let <var>list A</var> and <var>list B</var> be empty lists.</p>
     <li data-md="">
      <p>For each <var>expression A</var> in <var>A</var>:</p>
      <ol>
       <li data-md="">
        <p>If <var>expression A</var> is "<code>self</code>", append a <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-host-source"><code>host-source</code></a>,
  returned by <a href="#rewrite-self">Â§4.2.2 Rewrite 'self' into a host-source expression for origin.</a> given <var>origin A</var> to <var>list A</var>.</p>
       <li data-md="">
        <p>If <var>expression A</var> matches the U+002A ASTERISK character (<code>*</code>),
   append to <var>list A</var> the following <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-source"><code>scheme-source</code></a> expressions: "<code>ftp:</code>", "<code>http:</code>", "<code>https:</code>", "<code>ws:</code>", "<code>wss:</code>",
   and <var>origin A</var>âs <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-scheme">scheme</a>.</p>
        <ol>
         <li data-md="">
          <p>If <var>directive A</var> is either "<code>img-src</code>" or "<code>media-src", append a &lt;a grammar></code>scheme-source<code>&lt;/a> expression "</code>data:<code>" to |list A|.&lt;/p> &lt;/li>&lt;li data-md>&lt;p>If |directive A| is "</code>media-src", append a <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-source"><code>scheme-source</code></a> expression "<code>blob:</code>" to <var>list A</var>.</p>
         <li data-md="">
          <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue">Continue</a> to the next <var>expression A</var>.</p>
        </ol>
       <li data-md="">
        <p>If <var>expression A</var> does not match <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-keyword-source"><code>keyword-source</code></a> grammar, append <var>expression A</var> to <var>list A</var>.</p>
      </ol>
     <li data-md="">
      <p>For each <var>expression B</var> in <var>B</var>:</p>
      <ol>
       <li data-md="">
        <p>If <var>expression B</var> is "<code>self</code>", append a <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-host-source"><code>host-source</code></a>,
  returned by <a href="#rewrite-self">Â§4.2.2 Rewrite 'self' into a host-source expression for origin.</a> given <var>origin B</var> to <var>list B</var>.</p>
       <li data-md="">
        <p>If <var>expression B</var> matches the U+002A ASTERISK character (<code>*</code>),
  append to <var>list B</var> the following <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-source"><code>scheme-source</code></a> expressions: "<code>ftp:</code>", "<code>http:</code>", "<code>https:</code>", "<code>ws:</code>", "<code>wss:</code>",
  and <var>origin B</var>âs <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-scheme">scheme</a>.</p>
        <ol>
         <li data-md="">
          <p>If <var>directive B</var> is either "<code>img-src</code>" or "<code>media-src", append a &lt;a grammar></code>scheme-source<code>&lt;/a> expression "</code>data:<code>" to |list B|.&lt;/p> &lt;/li>&lt;li data-md>&lt;p>If |directive B| is "</code>media-src", append a <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-source"><code>scheme-source</code></a> expression "<code>blob:</code>" to <var>list B</var>.</p>
         <li data-md="">
          <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue">Continue</a> to the next <var>expression B</var>.</p>
        </ol>
       <li data-md="">
        <p>If <var>expression B</var> does not match <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-keyword-source"><code>keyword-source</code></a> grammar, append <var>expression B</var> to <var>list B</var>.</p>
      </ol>
     <li data-md="">
      <p>If <var>list B</var> is empty, return "<code>Subsumes</code>".</p>
     <li data-md="">
      <p>If <var>list A</var> is empty, return "<code>Does Not Subsume</code>".</p>
     <li data-md="">
      <p>For each <var>expression B</var> in <var>list B</var>:</p>
      <ol>
       <li data-md="">
        <p>If <var>expression B</var> matches the <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-hash-source"><code>hash-source</code></a> gramar, or <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-nonce-source"><code>nonce-source</code></a> grammar, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue">continue</a> to the next expression unless <var>directive A</var> is "<code>script-src</code>" or
  "<code>style-src</code>".</p>
       <li data-md="">
        <p>Let <var>found match</var> be <code>false</code>.</p>
       <li data-md="">
        <p>For each <var>expression A</var> in <var>list A</var>:</p>
        <ol>
         <li data-md="">
          <p>If <a href="#subsume-source-expressions">Â§4.2.3 Does source expression A subsume source expression B?</a> returns "<code>Subsumes</code>" given <var>expression A</var> and <var>expression B</var>, set <var>found match</var> to <code>true</code>.
  Break out of this inner loop.</p>
        </ol>
       <li data-md="">
        <p>If <var>found match</var> is <code>false</code>, return "<code>Does Not Subsume</code>".</p>
      </ol>
     <li data-md="">
      <p>Return "<code>Subsumes</code>".</p>
    </ol>
    <div class="example" id="example-2c99cc37">
     <a class="self-link" href="#example-2c99cc37"></a> Let <var>directive A</var> and <var>directive B</var> be "<code>script-src</code>". Consider
    the following examples: 
<pre>A = "http://example.com 'sha256-xzi4zkCjuC8'"
B = "http://example.com"
</pre>
     <p>Since <var>B</var> does not allow <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-hash-source"><code>hash-source</code></a> expressions, but its
    value is found in <var>A</var>, <var>A</var> subsumes <var>B</var>. It is, however, not true that <var>A</var> <a data-link-type="dfn" href="#policy-subsume" id="ref-for-policy-subsume-7">subsumes</a> <var>B</var>.</p>
<pre>A = "https://example.com 'sha256-xzi4zkCjuC8'"
B = "http://example.com"
</pre>
     <p>In this case, <var>A</var> does not subsume <var>B</var> since "https://example.com" does
    not <a data-link-type="dfn" href="#policy-subsume" id="ref-for-policy-subsume-8">subsume</a> "http://example.com".</p>
<pre>A = "http://example.com 'sha256-xzi4zkCjuC8'"
B = "http://example.com 'unsafe-inline'"
</pre>
     <p>Since <var>B</var> <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#source-list-allows-all-inline-behavior">allows all inline behavior</a>,
    but <var>A</var> does not, <var>A</var> doesnât <a data-link-type="dfn" href="#policy-subsume" id="ref-for-policy-subsume-9">subsume</a> <var>B</var>.</p>
<pre>A = "http://example.com 'sha256-xzi4zkCjuC8' 'strict-dynamic'"
B = "http://example.com 'unsafe-inline' 'strict-dynamic'"
</pre>
     <p>Neither <var>A</var> nor <var>B</var> <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#source-list-allows-all-inline-behavior">allows all inline behavior</a>.
    In this case, <var>A</var> <a data-link-type="dfn" href="#policy-subsume" id="ref-for-policy-subsume-10">subsumes</a> <var>B</var>.</p>
    </div>
    <h4 class="heading settled algorithm" data-algorithm="Does policy A subsume policy B given their respective
    origins?" data-level="4.2.5" id="subsume-policy"><span class="secno">4.2.5. </span><span class="content"> Does <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#violation-policy">policy</a> <var>A</var> subsume <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#violation-policy">policy</a> <var>B</var> given their respective <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-origin">origins</a>? </span><a class="self-link" href="#subsume-policy"></a></h4>
    <p>Given a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#violation-policy">policy</a> <var>A</var> with an <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-origin">origin</a> (<var>origin A</var>) and a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#violation-policy">policy</a> <var>B</var> with an <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-origin">origin</a> (<var>origin B</var>), this algorithm returns "<code>Subsumes</code>"
  if <var>A</var> <a data-link-type="dfn" href="#policy-subsume" id="ref-for-policy-subsume-11">subsumes</a> <var>B</var>, and returns "<code>Does Not Subsume</code>"
  otherwise.</p>
    <ol>
     <li data-md="">
      <p>If <var>A</var>âs <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#policy-directive-set">directive set</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-is-empty">is empty</a>,
  return "<code>Subsumes</code>".</p>
     <li data-md="">
      <p>For each <var>directive A</var> in <var>A</var>âs <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#policy-directive-set">directive set</a>:</p>
      <ol>
       <li data-md="">
        <p>Let <var>directive name</var> be <var>directive A</var>âs <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-name">name</a>.</p>
       <li data-md="">
        <p>If <var>directive name</var> is "<code>default-src</code>", "<code>report-uri</code>", "<code>report-to</code>", <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue">continue</a>.</p>
       <li data-md="">
        <p>Let <var>effective directive A</var> be the <a data-link-type="dfn" href="#effective-directive-value" id="ref-for-effective-directive-value-3">effective directive value</a> for <var>directive name</var> and <var>A</var>.</p>
       <li data-md="">
        <p>Let <var>effective directive B</var> be the <a data-link-type="dfn" href="#effective-directive-value" id="ref-for-effective-directive-value-4">effective directive value</a> for <var>directive name</var> and <var>B</var>.</p>
       <li data-md="">
        <p>If <var>effective directive A</var> is <code>null</code>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue">continue</a>.</p>
       <li data-md="">
        <p>If <var>effective directive B</var> is <code>null</code>, return "<code>Does Not Subsume</code>".</p>
       <li data-md="">
        <p>If <var>directive A</var>âs <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-name">name</a> is "<code>frame-ancestors</code>":</p>
        <ol>
         <li data-md="">
          <p class="issue" id="issue-95f2d23a"><a class="self-link" href="#issue-95f2d23a"></a> TODO.</p>
        </ol>
       <li data-md="">
        <p>If <var>directive A</var>âs <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-name">name</a> is "<code>plugin-types</code>":</p>
        <ol>
         <li data-md="">
          <p class="issue" id="issue-95f2d23a0"><a class="self-link" href="#issue-95f2d23a0"></a> TODO.</p>
        </ol>
       <li data-md="">
        <p>If <var>directive A</var>âs <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-name">name</a> is "<code>sandbox</code>":</p>
        <ol>
         <li data-md="">
          <p class="issue" id="issue-95f2d23a1"><a class="self-link" href="#issue-95f2d23a1"></a> TODO.</p>
        </ol>
       <li data-md="">
        <p>If <var>directive A</var>âs <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-name">name</a> is "<code>disown-opener</code>", <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue">continue</a>.</p>
       <li data-md="">
        <p>Otherwise:</p>
        <ol>
         <li data-md="">
          <p>If the result of executing <a href="#subsume-source-list">Â§4.2.4 Does source list A subsume source listB given their
    respective origins and directive names?</a> is
  "<code>Does Not Subsume</code>" given <var>effective directive A</var>, <var>origin A</var>, <var>directive name</var>, <var>effective directive B</var>, <var>origin B</var>, and <var>directive name</var>, return "<code>Does Not Subsume</code>".</p>
        </ol>
      </ol>
      <ol start="3">
       <li data-md="">
        <p>Return "<code>Subsumes</code>".</p>
      </ol>
    </ol>
    <h3 class="heading settled algorithm" data-algorithm="Does subsuming policy subsume policy list given their respective
    origins?" data-level="4.3" id="subsume-policy-list"><span class="secno">4.3. </span><span class="content"> Does <var>subsuming policy</var> subsume <var>policy list</var> given their respective <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin">origins</a>? </span><a class="self-link" href="#subsume-policy-list"></a></h3>
    <p>Given a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#violation-policy">policy</a> <var>subsuming policy</var> with an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin">origin</a> (<var>subsuming origin</var>) and a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list">list</a> of <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#violation-policy">policy</a> objects <var>policy list</var> with an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin">origin</a> (<var>origin</var>), this algorithm returns "<code>Subsumes</code>"
  if <var>subsuming policy</var> <a data-link-type="dfn" href="#policy-subsume" id="ref-for-policy-subsume-12">subsumes</a> <var>policy list</var>, and returns
  "<code>Does Not Subsume</code>" otherwise.</p>
    <ol class="algorithm">
     <li data-md="">
      <p>If <var>subsuming policy</var> is <code>null</code>, return "<code>Subsumes</code>".</p>
     <li data-md="">
      <p>If <var>subsuming policy</var>âs <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#policy-disposition">disposition</a> is "<code>report</code>",
  return "<code>Subsumes</code>".</p>
     <li data-md="">
      <p>If <var>subsuming policy</var>âs <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#policy-directive-set">directive set</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-is-empty">is empty</a>, return "<code>Subsumes</code>".</p>
     <li data-md="">
      <p>If <var>policy list</var> is <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-is-empty">is empty</a> or <code>null</code>, return
  "<code>Does Not Subsume</code>".</p>
     <li data-md="">
      <p>Let <var>effective policy</var> the result of executing <a href="#intersection-policy-list">Â§3.1.1 Policy List intersection</a> given <var>policy list</var> and <var>origin</var>.</p>
     <li data-md="">
      <p>Return the result of executing <a href="#subsume-policy">Â§4.2.5 Does policy A subsume policy B given their respective
    origins?</a> given <var>subsuming policy</var>, <var>subsuming origin</var>, <var>effective policy</var>, and <var>origin</var>.</p>
    </ol>
   </section>
   <section>
    <h2 class="heading settled" data-level="5" id="security-and-privacy-considerations"><span class="secno">5. </span><span class="content">Security and Privacy Considerations</span><a class="self-link" href="#security-and-privacy-considerations"></a></h2>
    <h3 class="heading settled" data-level="5.1" id="policy-enforcement"><span class="secno">5.1. </span><span class="content">Policy Enforcement</span><a class="self-link" href="#policy-enforcement"></a></h3>
    <p>Embedded documents should be careful to evaluate the proposed Content Security
  Policy, and not simply to reflect whatever policy an embedder suggests. Doing
  so may enable a clever attacker to selectively disable pieces of a websiteâs
  code which are essential for its own protection.</p>
    <p>In particular, documents which do not expect to be embedded should continue to
  respond to any such request with a Content Security Policy containing an
  appropriate <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#frame-ancestors"><code>frame-ancestors</code></a> directive.</p>
    <h3 class="heading settled" data-level="5.2" id="policy-leakage"><span class="secno">5.2. </span><span class="content">Policy Leakage</span><a class="self-link" href="#policy-leakage"></a></h3>
    <p>The enforcement mechanism allows a malicious embedder to read a pageâs policy
  cross-origin by brute-forcing its constraints. This could leak interesting
  data about the page or the user loading the page if the policy contains secret
  tokens or usernames.</p>
    <p>Again, the best defense here is to control the contexts allowed to embed a
  given resource via an appropriate <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#frame-ancestors"><code>frame-ancestors</code></a> directive.</p>
    <h3 class="heading settled" data-level="5.3" id="exfiltration"><span class="secno">5.3. </span><span class="content">Data Exfiltration</span><a class="self-link" href="#exfiltration"></a></h3>
    <p>This feature allows an embedder to send information to a third-party endpoint
  via the <a data-link-type="http-header" href="#http-headerdef-sec-required-csp" id="ref-for-http-headerdef-sec-required-csp-8"><code>Sec-Required-CSP</code></a> HTTP header. This doesnât seem to
  expose any information that couldnât be tunneled in the HTTP request itself
  (via GET parameters, etc), and embedders remain in control over the endpoints
  to which such requests may be made by enforcing a Content Security Policy with
  an appropriate <code>child-src</code> directive.</p>
    <h3 class="heading settled" data-level="5.4" id="header-injection"><span class="secno">5.4. </span><span class="content">Header Injection</span><a class="self-link" href="#header-injection"></a></h3>
    <p class="issue" id="issue-239dbe2c"><a class="self-link" href="#issue-239dbe2c"></a> Spell out the concerns Mario raised in the thread around <a href="https://twitter.com/0x6D6172696F/status/810066803653308416">https://twitter.com/0x6D6172696F/status/810066803653308416</a>.</p>
    <h3 class="heading settled" data-level="5.5" id="header-reflection"><span class="secno">5.5. </span><span class="content">Header Reflection</span><a class="self-link" href="#header-reflection"></a></h3>
    <p class="issue" id="issue-239dbe2c0"><a class="self-link" href="#issue-239dbe2c0"></a> Spell out the concerns Mario raised in the thread around <a href="https://twitter.com/0x6D6172696F/status/810066803653308416">https://twitter.com/0x6D6172696F/status/810066803653308416</a>.</p>
   </section>
   <section>
    <h2 class="heading settled" data-level="6" id="authoring-considerations"><span class="secno">6. </span><span class="content">Authoring Considerations</span><a class="self-link" href="#authoring-considerations"></a></h2>
    <h3 class="heading settled" data-level="6.1" id="effect-self"><span class="secno">6.1. </span><span class="content"> Requiring <code>'self'</code> </span><a class="self-link" href="#effect-self"></a></h3>
    <p>When processing a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#browsing-context">browsing context</a>âs <a data-link-type="dfn" href="#browsing-context-required-csp" id="ref-for-browsing-context-required-csp-12">required CSP</a>, the
  keyword <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-self"><code>'self'</code></a> refers to the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin">origin</a> of the URL being loaded
  into the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#nested-browsing-context">nested browsing context</a>, not to the origin of the document in the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#source-browsing-context">source
  browsing context</a>.</p>
    <div class="example" id="example-8771b2e9">
     <a class="self-link" href="#example-8771b2e9"></a> MegaCorp Inc. requires a policy containing <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-self"><code>'self'</code></a> on their page at <code>https://example.com/page.html</code>: 
<pre>&lt;iframe src="https://advertisements-r-us.example.com/ad1.cfm"
        <a data-link-type="element-attr" href="#element-attrdef-iframe-csp" id="ref-for-element-attrdef-iframe-csp-15">csp</a>="script-src 'self'">
&lt;/iframe>
</pre>
     <p>If the returned CSP is:</p>
<pre>Content-Security-Policy: script-src 'self'
</pre>
     <p>Then this <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/embedded-content.html#the-iframe-element">iframe</a></code> element will be loaded.</p>
     <p>If, however, the returned CSP is:</p>
<pre>Content-Security-Policy: script-src "https://example.com/"
</pre>
     <p>Then this <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/embedded-content.html#the-iframe-element">iframe</a></code> element will not be loaded.</p>
    </div>
   </section>
   <section>
    <h2 class="heading settled" data-level="7" id="iana"><span class="secno">7. </span><span class="content">IANA Considerations</span><a class="self-link" href="#iana"></a></h2>
    <p>The permanent message header field registry should be updated
  with the following registration for the <a data-link-type="http-header" href="#http-headerdef-sec-required-csp" id="ref-for-http-headerdef-sec-required-csp-9"><code>Sec-Required-CSP</code></a> header: <a data-link-type="biblio" href="#biblio-rfc3864">[RFC3864]</a></p>
    <dl>
     <dt data-md="">Header field name
     <dd data-md="">
      <p>Sec-Required-CSP</p>
     <dt data-md="">Applicable protocol
     <dd data-md="">
      <p>http</p>
     <dt data-md="">Status
     <dd data-md="">
      <p>standard</p>
     <dt data-md="">Author/Change controller
     <dd data-md="">
      <p>W3C</p>
     <dt data-md="">Specification document
     <dd data-md="">
      <p>This specification (See <a href="#required-csp-header">Â§2.2 The Sec-Required-CSP HTTP Request Header</a>)</p>
    </dl>
    <p>Likewise, the registry should be updated with the following registration
  for the <a data-link-type="http-header" href="#http-headerdef-allow-csp-from" id="ref-for-http-headerdef-allow-csp-from-8"><code>Allow-CSP-From</code></a> header: <a data-link-type="biblio" href="#biblio-rfc3864">[RFC3864]</a></p>
    <dl>
     <dt data-md="">Header field name
     <dd data-md="">
      <p>Allow-CSP-From</p>
     <dt data-md="">Applicable protocol
     <dd data-md="">
      <p>http</p>
     <dt data-md="">Status
     <dd data-md="">
      <p>standard</p>
     <dt data-md="">Author/Change controller
     <dd data-md="">
      <p>W3C</p>
     <dt data-md="">Specification document
     <dd data-md="">
      <p>This specification (See <a href="#allow-csp-from-header">Â§2.3 The Allow-CSP-From HTTP Response Header</a>)</p>
    </dl>
   </section>
  </main>
  <h2 class="no-ref no-num heading settled" id="conformance"><span class="content">Conformance</span><a class="self-link" href="#conformance"></a></h2>
  <h3 class="no-ref no-num heading settled" id="conventions"><span class="content">Document conventions</span><a class="self-link" href="#conventions"></a></h3>
  <p>Conformance requirements are expressed with a combination of
    descriptive assertions and RFC 2119 terminology. The key words âMUSTâ,
    âMUST NOTâ, âREQUIREDâ, âSHALLâ, âSHALL NOTâ, âSHOULDâ, âSHOULD NOTâ,
    âRECOMMENDEDâ, âMAYâ, and âOPTIONALâ in the normative parts of this
    document are to be interpreted as described in RFC 2119.
    However, for readability, these words do not appear in all uppercase
    letters in this specification. </p>
  <p>All of the text of this specification is normative except sections
    explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119">[RFC2119]</a></p>
  <p>Examples in this specification are introduced with the words âfor exampleâ
    or are set apart from the normative text with <code>class="example"</code>,
    like this: </p>
  <div class="example" id="example-f839f6c8">
   <a class="self-link" href="#example-f839f6c8"></a> 
   <p>This is an example of an informative example.</p>
  </div>
  <p>Informative notes begin with the word âNoteâ and are set apart from the
    normative text with <code>class="note"</code>, like this: </p>
  <p class="note" role="note">Note, this is an informative note.</p>
  <h3 class="no-ref no-num heading settled" id="conformant-algorithms"><span class="content">Conformant Algorithms</span><a class="self-link" href="#conformant-algorithms"></a></h3>
  <p>Requirements phrased in the imperative as part of algorithms (such as
    "strip any leading space characters" or "return false and abort these
    steps") are to be interpreted with the meaning of the key word ("must",
    "should", "may", etc) used in introducing the algorithm.</p>
  <p>Conformance requirements phrased as algorithms or specific steps can be
    implemented in any manner, so long as the end result is equivalent. In
    particular, the algorithms defined in this specification are intended to
    be easy to understand and are not intended to be performant. Implementers
    are encouraged to optimize.</p>
<script src="https://www.w3.org/scripts/TR/2016/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#http-headerdef-allow-csp-from">Allow-CSP-From</a><span>, in Â§2.3</span>
   <li><a href="#directive-contains">contains</a><span>, in Â§4.2.4</span>
   <li>
    csp
    <ul>
     <li><a href="#element-attrdef-iframe-csp">element-attr for iframe</a><span>, in Â§2.1</span>
     <li><a href="#dom-htmliframeelement-csp">attribute for HTMLIFrameElement</a><span>, in Â§2.1</span>
    </ul>
   <li><a href="#effective-directive-value">effective directive value</a><span>, in Â§3.1.4.1</span>
   <li><a href="#effective-source-list">effective source list</a><span>, in Â§3.1.4.2</span>
   <li>
    intersection
    <ul>
     <li><a href="#policy-intersection">dfn for policy</a><span>, in Â§3</span>
     <li><a href="#source-expression-intersection">dfn for source expression</a><span>, in Â§4.2.1</span>
    </ul>
   <li><a href="#abstract-opdef-intersection-of-policy-list-for-origin">intersection of policy list for origin</a><span>, in Â§3.1.1</span>
   <li><a href="#abstract-opdef-intersection-of-two-policies">intersection of two policies</a><span>, in Â§3.1.2</span>
   <li><a href="#abstract-opdef-intersection-of-two-source-lists">intersection of two source lists</a><span>, in Â§3.1.3</span>
   <li><a href="#browsing-context-required-csp">required CSP</a><span>, in Â§2.4.1</span>
   <li><a href="#http-headerdef-sec-required-csp">Sec-Required-CSP</a><span>, in Â§2.2</span>
   <li><a href="#abstract-opdef-set-the-sec-required-csp-header">set-required-csp</a><span>, in Â§2.2</span>
   <li><a href="#abstract-opdef-set-the-required-csp">set the required CSP</a><span>, in Â§2.4.1</span>
   <li><a href="#abstract-opdef-set-the-sec-required-csp-header">set the Sec-Required-CSP header</a><span>, in Â§2.2</span>
   <li><a href="#abstract-opdef-similarity-of-two-source-expressions">similarity of two source expressions</a><span>, in Â§3.1.4.3</span>
   <li><a href="#policy-subsume">subsume</a><span>, in Â§3</span>
   <li><a href="#policy-subsumed-by">subsumed by</a><span>, in Â§3</span>
   <li><a href="#iframe-csp-valid-attribute-value">valid attribute value</a><span>, in Â§2.1</span>
   <li><a href="#source-expression-wildcard-host">wildcard host</a><span>, in Â§3.1.4.3</span>
   <li><a href="#source-expression-wildcard-port">wildcard port</a><span>, in Â§3.1.4.3</span>
  </ul>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[CSP3]</a> defines the following terms:
    <ul>
     <li><a href="https://w3c.github.io/webappsec-csp/#grammardef-none">'none'</a>
     <li><a href="https://w3c.github.io/webappsec-csp/#grammardef-self">'self'</a>
     <li><a href="https://w3c.github.io/webappsec-csp/#grammardef-strict-dynamic">'strict-dynamic'</a>
     <li><a href="https://w3c.github.io/webappsec-csp/#grammardef-unsafe-inline">'unsafe-inline'</a>
     <li><a href="https://w3c.github.io/webappsec-csp/#source-list-allows-all-inline-behavior">allows all inline behavior</a>
     <li><a href="https://w3c.github.io/webappsec-csp/#header-content-security-policy">content-security-policy</a>
     <li><a href="https://w3c.github.io/webappsec-csp/#policy-directive-set">directive set</a>
     <li><a href="https://w3c.github.io/webappsec-csp/#directives">directives</a>
     <li><a href="https://w3c.github.io/webappsec-csp/#policy-disposition">disposition</a>
     <li><a href="https://w3c.github.io/webappsec-csp/#frame-ancestors">frame-ancestors</a>
     <li><a href="https://w3c.github.io/webappsec-csp/#grammardef-hash-source">hash-source</a>
     <li><a href="https://w3c.github.io/webappsec-csp/#grammardef-host-part">host-part</a>
     <li><a href="https://w3c.github.io/webappsec-csp/#grammardef-host-source">host-source</a>
     <li><a href="https://w3c.github.io/webappsec-csp/#grammardef-keyword-source">keyword-source</a>
     <li><a href="https://w3c.github.io/webappsec-csp/#grammardef-media-type">media-type</a>
     <li><a href="https://w3c.github.io/webappsec-csp/#directive-name">name</a>
     <li><a href="https://w3c.github.io/webappsec-csp/#grammardef-nonce-source">nonce-source</a>
     <li><a href="https://w3c.github.io/webappsec-csp/#parse-serialized-policy">parse a serialized csp as disposition</a>
     <li><a href="https://w3c.github.io/webappsec-csp/#grammardef-path-part">path-part</a>
     <li><a href="https://www.w3.org/TR/CSP3/#policy">policy</a>
     <li><a href="https://w3c.github.io/webappsec-csp/#violation-policy">policy <small>(for violation)</small></a>
     <li><a href="https://w3c.github.io/webappsec-csp/#grammardef-port-part">port-part</a>
     <li><a href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-part">scheme-part</a>
     <li><a href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-source">scheme-source</a>
     <li><a href="https://w3c.github.io/webappsec-csp/#serialized-csp">serialized csp</a>
     <li><a href="https://w3c.github.io/webappsec-csp/#grammardef-serialized-policy">serialized-policy</a>
     <li><a href="https://w3c.github.io/webappsec-csp/#source-expression">source expression</a>
     <li><a href="https://w3c.github.io/webappsec-csp/#source-lists">source lists</a>
     <li><a href="https://w3c.github.io/webappsec-csp/#directive-value">value</a>
    </ul>
   <li>
    <a data-link-type="biblio">[css-values-3]</a> defines the following terms:
    <ul>
     <li><a href="https://drafts.csswg.org/css-values-4/#mult-zero-plus">*</a>
    </ul>
   <li>
    <a data-link-type="biblio">[DOM]</a> defines the following terms:
    <ul>
     <li><a href="https://dom.spec.whatwg.org/#concept-element">element</a>
     <li><a href="https://dom.spec.whatwg.org/#concept-node-document">node document</a>
    </ul>
   <li>
    <a data-link-type="biblio">[ENCODING]</a> defines the following terms:
    <ul>
     <li><a href="https://encoding.spec.whatwg.org/#utf-8-encode">utf-8 encode</a>
    </ul>
   <li>
    <a data-link-type="biblio">[FETCH]</a> defines the following terms:
    <ul>
     <li><a href="https://fetch.spec.whatwg.org/#concept-header-list-append">append</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-request-client">client</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-response-csp-list">csp list</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-request-header-list">header list <small>(for request)</small></a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-response-header-list">header list <small>(for response)</small></a>
     <li><a href="https://fetch.spec.whatwg.org/#local-scheme">local scheme</a>
     <li><a href="https://fetch.spec.whatwg.org/#navigation-request">navigation request</a>
     <li><a href="https://fetch.spec.whatwg.org/#network-scheme">network scheme</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-request-origin">origin</a>
     <li><a href="https://fetch.spec.whatwg.org/#http-origin">origin-or-null</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-request">request</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-response">response</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-response-url">url</a>
     <li><a href="https://fetch.spec.whatwg.org/#http-new-header-syntax">wildcard</a>
    </ul>
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><a href="https://html.spec.whatwg.org/multipage/scripting.html#cereactions">CEReactions</a>
     <li><a href="https://html.spec.whatwg.org/multipage/embedded-content.html#htmliframeelement">HTMLIFrameElement</a>
     <li><a href="https://html.spec.whatwg.org/multipage/browsers.html#active-document">active document</a>
     <li><a href="https://html.spec.whatwg.org/multipage/browsers.html#ascii-serialisation-of-an-origin">ascii serialization of an origin</a>
     <li><a href="https://html.spec.whatwg.org/multipage/browsers.html#browsing-context">browsing context</a>
     <li><a href="https://html.spec.whatwg.org/multipage/browsers.html#concept-document-bc">browsing context <small>(for Document)</small></a>
     <li><a href="https://html.spec.whatwg.org/multipage/browsers.html#browsing-context-container">browsing context container</a>
     <li><a href="https://html.spec.whatwg.org/multipage/infrastructure.html#case-sensitive">case-sensitive</a>
     <li><a href="https://html.spec.whatwg.org/multipage/dom.html#concept-element-attributes">content attributes</a>
     <li><a href="https://html.spec.whatwg.org/multipage/embedded-content.html#the-iframe-element">iframe</a>
     <li><a href="https://html.spec.whatwg.org/multipage/browsers.html#navigate">navigate</a>
     <li><a href="https://html.spec.whatwg.org/multipage/browsers.html#nested-browsing-context">nested browsing context</a>
     <li><a href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-opaque">opaque origin</a>
     <li><a href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin">origin</a>
     <li><a href="https://html.spec.whatwg.org/multipage/browsers.html#parent-browsing-context">parent browsing context</a>
     <li><a href="https://html.spec.whatwg.org/multipage/browsers.html#process-a-navigate-fetch">process a navigate fetch</a>
     <li><a href="https://html.spec.whatwg.org/multipage/browsers.html#process-a-navigate-response">process a navigate response</a>
     <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#responsible-browsing-context">responsible browsing context</a>
     <li><a href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-scheme">scheme</a>
     <li><a href="https://html.spec.whatwg.org/multipage/browsers.html#source-browsing-context">source browsing context</a>
    </ul>
   <li>
    <a data-link-type="biblio">[INFRA]</a> defines the following terms:
    <ul>
     <li><a href="https://infra.spec.whatwg.org/#set-append">append</a>
     <li><a href="https://infra.spec.whatwg.org/#ascii-case-insensitive">ascii case-insensitive</a>
     <li><a href="https://infra.spec.whatwg.org/#list-contain">contain</a>
     <li><a href="https://infra.spec.whatwg.org/#iteration-continue">continue</a>
     <li><a href="https://infra.spec.whatwg.org/#list-is-empty">is empty</a>
     <li><a href="https://infra.spec.whatwg.org/#list">list</a>
     <li><a href="https://infra.spec.whatwg.org/#ordered-set">set</a>
     <li><a href="https://infra.spec.whatwg.org/#string">string</a>
    </ul>
   <li>
    <a data-link-type="biblio">[URL]</a> defines the following terms:
    <ul>
     <li><a href="https://url.spec.whatwg.org/#concept-url-origin">origin</a>
     <li><a href="https://url.spec.whatwg.org/#concept-url-scheme">scheme</a>
    </ul>
   <li>
    <a data-link-type="biblio">[WEBIDL]</a> defines the following terms:
    <ul>
     <li><a href="https://heycam.github.io/webidl/#idl-DOMString">DOMString</a>
     <li><a href="https://heycam.github.io/webidl/#dfn-getter">getter</a>
     <li><a href="https://heycam.github.io/webidl/#dfn-setter">setter</a>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-csp3">[CSP3]
   <dd>Mike West. <a href="https://www.w3.org/TR/CSP3/">Content Security Policy Level 3</a>. URL: <a href="https://www.w3.org/TR/CSP3/">https://www.w3.org/TR/CSP3/</a>
   <dt id="biblio-css-values-3">[CSS-VALUES-3]
   <dd>Tab Atkins Jr.; Elika Etemad. <a href="https://www.w3.org/TR/css-values-3/">CSS Values and Units Module Level 3</a>. URL: <a href="https://www.w3.org/TR/css-values-3/">https://www.w3.org/TR/css-values-3/</a>
   <dt id="biblio-dom">[DOM]
   <dd>Anne van Kesteren. <a href="https://dom.spec.whatwg.org/">DOM Standard</a>. Living Standard. URL: <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
   <dt id="biblio-encoding">[ENCODING]
   <dd>Anne van Kesteren. <a href="https://encoding.spec.whatwg.org/">Encoding Standard</a>. Living Standard. URL: <a href="https://encoding.spec.whatwg.org/">https://encoding.spec.whatwg.org/</a>
   <dt id="biblio-fetch">[FETCH]
   <dd>Anne van Kesteren. <a href="https://fetch.spec.whatwg.org/">Fetch Standard</a>. Living Standard. URL: <a href="https://fetch.spec.whatwg.org/">https://fetch.spec.whatwg.org/</a>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/">HTML Standard</a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-infra">[INFRA]
   <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/">Infra Standard</a>. Living Standard. URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>. March 1997. Best Current Practice. URL: <a href="https://tools.ietf.org/html/rfc2119">https://tools.ietf.org/html/rfc2119</a>
   <dt id="biblio-rfc3864">[RFC3864]
   <dd>G. Klyne; M. Nottingham; J. Mogul. <a href="https://tools.ietf.org/html/rfc3864">Registration Procedures for Message Header Fields</a>. September 2004. Best Current Practice. URL: <a href="https://tools.ietf.org/html/rfc3864">https://tools.ietf.org/html/rfc3864</a>
   <dt id="biblio-rfc5234">[RFC5234]
   <dd>D. Crocker, Ed.; P. Overell. <a href="https://tools.ietf.org/html/rfc5234">Augmented BNF for Syntax Specifications: ABNF</a>. January 2008. Internet Standard. URL: <a href="https://tools.ietf.org/html/rfc5234">https://tools.ietf.org/html/rfc5234</a>
   <dt id="biblio-url">[URL]
   <dd>Anne van Kesteren. <a href="https://url.spec.whatwg.org/">URL Standard</a>. Living Standard. URL: <a href="https://url.spec.whatwg.org/">https://url.spec.whatwg.org/</a>
   <dt id="biblio-webidl">[WEBIDL]
   <dd>Cameron McCormack; Boris Zbarsky; Tobie Langel. <a href="https://heycam.github.io/webidl/">Web IDL</a>. URL: <a href="https://heycam.github.io/webidl/">https://heycam.github.io/webidl/</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL Index</span><a class="self-link" href="#idl-index"></a></h2>
<pre class="idl highlight def"><span class="kt"><span class="kt">partial</span></span> <span class="kt"><span class="kt">interface</span></span> <a class="nv idl-code" data-link-type="interface" href="https://html.spec.whatwg.org/multipage/embedded-content.html#htmliframeelement"><span class="nv">HTMLIFrameElement</span></a> {
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://html.spec.whatwg.org/multipage/scripting.html#cereactions"><span class="nv">CEReactions</span></a>] <span class="kt"><span class="kt">attribute</span></span> <a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString"><span class="kt"><span class="kt">DOMString</span></span></a> <a class="nv" data-type="DOMString" href="#dom-htmliframeelement-csp"><span class="nv">csp</span></a>;
};

</pre>
  <h2 class="no-num no-ref heading settled" id="issues-index"><span class="content">Issues Index</span><a class="self-link" href="#issues-index"></a></h2>
  <div style="counter-reset:issue">
   <div class="issue"> Upstream this to all the HTMLs.<a href="#issue-2a91d948"> âµ </a></div>
   <div class="issue"> Upstream this to WHATWGâs HTML.<a href="#issue-fdc1da1f"> âµ </a></div>
   <div class="issue"> W3Câs HTMLâs navigation algorithm is wildly divergent from WHATWGâs at
  this point. Upstream something to that document once things are reconciled. <a href="https://github.com/w3c/html/issues/584">&lt;https://github.com/w3c/html/issues/584></a><a href="#issue-9e9d2c02"> âµ </a></div>
   <div class="issue"> Upstream this to WHATWGâs HTML.<a href="#issue-fdc1da1f0"> âµ </a></div>
   <div class="issue"> W3Câs HTML is not based on Fetch, and does not have
  a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#process-a-navigate-response">process a navigate response</a> algorithm into which to hook. <a href="https://github.com/w3c/html/issues/584">&lt;https://github.com/w3c/html/issues/584></a><a href="#issue-a3a64cc9"> âµ </a></div>
   <div class="issue"> Upstream this to WHATWGâs HTML.<a href="#issue-fdc1da1f1"> âµ </a></div>
   <div class="issue"> W3Câs HTML is not based on Fetch, and does not have
  a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#process-a-navigate-fetch">process a navigate fetch</a> algorithm into which to hook. <a href="https://github.com/w3c/html/issues/584">&lt;https://github.com/w3c/html/issues/584></a><a href="#issue-7b3609ea"> âµ </a></div>
   <div class="issue"> Upstream a hook to HTML.<a href="#issue-b71d345b"> âµ </a></div>
   <div class="issue"> We shouldnât make the reader do this exercise.<a href="#issue-f2ff64e0"> âµ </a></div>
   <div class="issue"> We need to extend this definition to handle things that are not source lists.
  Also, we should be more precise about this, perhaps by defining a term like "source list
  directive" that we could check against <var>directive name</var>.<a href="#issue-1552fb5c"> âµ </a></div>
   <div class="issue"> Move the remaining intersection algorithms into this section.<a href="#issue-b43dcb1b"> âµ </a></div>
   <div class="issue"> Move all the subsumption algorithms into this section.<a href="#issue-94e5cca5"> âµ </a></div>
   <div class="issue"> TODO.<a href="#issue-95f2d23a"> âµ </a></div>
   <div class="issue"> TODO.<a href="#issue-95f2d23a0"> âµ </a></div>
   <div class="issue"> TODO.<a href="#issue-95f2d23a1"> âµ </a></div>
   <div class="issue"> Spell out the concerns Mario raised in the thread around <a href="https://twitter.com/0x6D6172696F/status/810066803653308416">https://twitter.com/0x6D6172696F/status/810066803653308416</a>.<a href="#issue-239dbe2c"> âµ </a></div>
   <div class="issue"> Spell out the concerns Mario raised in the thread around <a href="https://twitter.com/0x6D6172696F/status/810066803653308416">https://twitter.com/0x6D6172696F/status/810066803653308416</a>.<a href="#issue-239dbe2c0"> âµ </a></div>
  </div>
  <aside class="dfn-panel" data-for="element-attrdef-iframe-csp">
   <b><a href="#element-attrdef-iframe-csp">#element-attrdef-iframe-csp</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-element-attrdef-iframe-csp-1">1.1. Examples</a> <a href="#ref-for-element-attrdef-iframe-csp-2">(2)</a>
    <li><a href="#ref-for-element-attrdef-iframe-csp-3">2. Framework</a>
    <li><a href="#ref-for-element-attrdef-iframe-csp-4">2.1. &lt;iframe>'s csp attribute</a> <a href="#ref-for-element-attrdef-iframe-csp-5">(2)</a> <a href="#ref-for-element-attrdef-iframe-csp-6">(3)</a> <a href="#ref-for-element-attrdef-iframe-csp-7">(4)</a> <a href="#ref-for-element-attrdef-iframe-csp-8">(5)</a> <a href="#ref-for-element-attrdef-iframe-csp-9">(6)</a> <a href="#ref-for-element-attrdef-iframe-csp-10">(7)</a> <a href="#ref-for-element-attrdef-iframe-csp-11">(8)</a>
    <li><a href="#ref-for-element-attrdef-iframe-csp-12">2.2. The Sec-Required-CSP HTTP Request Header</a>
    <li><a href="#ref-for-element-attrdef-iframe-csp-13">2.4. Integration with HTML</a>
    <li><a href="#ref-for-element-attrdef-iframe-csp-14">2.4.1. Browsing Contextâs Required CSP</a>
    <li><a href="#ref-for-element-attrdef-iframe-csp-15">6.1. 
    Requiring 'self' </a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="iframe-csp-valid-attribute-value">
   <b><a href="#iframe-csp-valid-attribute-value">#iframe-csp-valid-attribute-value</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-iframe-csp-valid-attribute-value-1">2.1. &lt;iframe>'s csp attribute</a> <a href="#ref-for-iframe-csp-valid-attribute-value-2">(2)</a>
    <li><a href="#ref-for-iframe-csp-valid-attribute-value-3">2.4.1. Browsing Contextâs Required CSP</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-htmliframeelement-csp">
   <b><a href="#dom-htmliframeelement-csp">#dom-htmliframeelement-csp</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-htmliframeelement-csp-1">2.1. &lt;iframe>'s csp attribute</a> <a href="#ref-for-dom-htmliframeelement-csp-2">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="http-headerdef-sec-required-csp">
   <b><a href="#http-headerdef-sec-required-csp">#http-headerdef-sec-required-csp</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-http-headerdef-sec-required-csp-1">1. Introduction</a>
    <li><a href="#ref-for-http-headerdef-sec-required-csp-2">1.1. Examples</a> <a href="#ref-for-http-headerdef-sec-required-csp-3">(2)</a>
    <li><a href="#ref-for-http-headerdef-sec-required-csp-4">2. Framework</a> <a href="#ref-for-http-headerdef-sec-required-csp-5">(2)</a>
    <li><a href="#ref-for-http-headerdef-sec-required-csp-6">2.2. The Sec-Required-CSP HTTP Request Header</a>
    <li><a href="#ref-for-http-headerdef-sec-required-csp-7">2.4. Integration with HTML</a>
    <li><a href="#ref-for-http-headerdef-sec-required-csp-8">5.3. Data Exfiltration</a>
    <li><a href="#ref-for-http-headerdef-sec-required-csp-9">7. IANA Considerations</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="abstract-opdef-set-the-sec-required-csp-header">
   <b><a href="#abstract-opdef-set-the-sec-required-csp-header">#abstract-opdef-set-the-sec-required-csp-header</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-abstract-opdef-set-the-sec-required-csp-header-1">2.4. Integration with HTML</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="http-headerdef-allow-csp-from">
   <b><a href="#http-headerdef-allow-csp-from">#http-headerdef-allow-csp-from</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-http-headerdef-allow-csp-from-1">1. Introduction</a>
    <li><a href="#ref-for-http-headerdef-allow-csp-from-2">1.1. Examples</a>
    <li><a href="#ref-for-http-headerdef-allow-csp-from-3">2. Framework</a> <a href="#ref-for-http-headerdef-allow-csp-from-4">(2)</a>
    <li><a href="#ref-for-http-headerdef-allow-csp-from-5">2.2. The Sec-Required-CSP HTTP Request Header</a>
    <li><a href="#ref-for-http-headerdef-allow-csp-from-6">3. Implicit Policy Acceptance</a>
    <li><a href="#ref-for-http-headerdef-allow-csp-from-7">4.2. 
    Does response allow blanket enforcment of policy from request? </a>
    <li><a href="#ref-for-http-headerdef-allow-csp-from-8">7. IANA Considerations</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="browsing-context-required-csp">
   <b><a href="#browsing-context-required-csp">#browsing-context-required-csp</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-browsing-context-required-csp-1">2.1. &lt;iframe>'s csp attribute</a> <a href="#ref-for-browsing-context-required-csp-2">(2)</a>
    <li><a href="#ref-for-browsing-context-required-csp-3">2.2. The Sec-Required-CSP HTTP Request Header</a>
    <li><a href="#ref-for-browsing-context-required-csp-4">2.4. Integration with HTML</a> <a href="#ref-for-browsing-context-required-csp-5">(2)</a>
    <li><a href="#ref-for-browsing-context-required-csp-6">2.4.1. Browsing Contextâs Required CSP</a> <a href="#ref-for-browsing-context-required-csp-7">(2)</a> <a href="#ref-for-browsing-context-required-csp-8">(3)</a> <a href="#ref-for-browsing-context-required-csp-9">(4)</a>
    <li><a href="#ref-for-browsing-context-required-csp-10">4.1. 
    Is response to request blocked by contextâs required CSP? </a> <a href="#ref-for-browsing-context-required-csp-11">(2)</a>
    <li><a href="#ref-for-browsing-context-required-csp-12">6.1. 
    Requiring 'self' </a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="abstract-opdef-set-the-required-csp">
   <b><a href="#abstract-opdef-set-the-required-csp">#abstract-opdef-set-the-required-csp</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-abstract-opdef-set-the-required-csp-1">2.4. Integration with HTML</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="policy-subsume">
   <b><a href="#policy-subsume">#policy-subsume</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-policy-subsume-1">3. Implicit Policy Acceptance</a> <a href="#ref-for-policy-subsume-2">(2)</a>
    <li><a href="#ref-for-policy-subsume-3">3.1.1. Policy List intersection</a>
    <li><a href="#ref-for-policy-subsume-4">3.1.2. Policy Intersection</a>
    <li><a href="#ref-for-policy-subsume-5">4.2.3. 
    Does source expression A subsume source expression B? </a>
    <li><a href="#ref-for-policy-subsume-6">4.2.4. 
    Does source list A subsume source listB given their
    respective origins and directive names? </a> <a href="#ref-for-policy-subsume-7">(2)</a> <a href="#ref-for-policy-subsume-8">(3)</a> <a href="#ref-for-policy-subsume-9">(4)</a> <a href="#ref-for-policy-subsume-10">(5)</a>
    <li><a href="#ref-for-policy-subsume-11">4.2.5. 
    Does policy A subsume policy B given their respective
    origins? </a>
    <li><a href="#ref-for-policy-subsume-12">4.3. 
    Does subsuming policy subsume policy list given their respective
    origins? </a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="policy-subsumed-by">
   <b><a href="#policy-subsumed-by">#policy-subsumed-by</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-policy-subsumed-by-1">2.1. &lt;iframe>'s csp attribute</a>
    <li><a href="#ref-for-policy-subsumed-by-2">3.1.2. Policy Intersection</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="policy-intersection">
   <b><a href="#policy-intersection">#policy-intersection</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-policy-intersection-1">3. Implicit Policy Acceptance</a>
    <li><a href="#ref-for-policy-intersection-2">3.1.1. Policy List intersection</a>
    <li><a href="#ref-for-policy-intersection-3">3.1.2. Policy Intersection</a> <a href="#ref-for-policy-intersection-4">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="abstract-opdef-intersection-of-two-policies">
   <b><a href="#abstract-opdef-intersection-of-two-policies">#abstract-opdef-intersection-of-two-policies</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-abstract-opdef-intersection-of-two-policies-1">3.1.1. Policy List intersection</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="abstract-opdef-intersection-of-two-source-lists">
   <b><a href="#abstract-opdef-intersection-of-two-source-lists">#abstract-opdef-intersection-of-two-source-lists</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-abstract-opdef-intersection-of-two-source-lists-1">3.1.2. Policy Intersection</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="effective-directive-value">
   <b><a href="#effective-directive-value">#effective-directive-value</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-effective-directive-value-1">3.1.2. Policy Intersection</a> <a href="#ref-for-effective-directive-value-2">(2)</a>
    <li><a href="#ref-for-effective-directive-value-3">4.2.5. 
    Does policy A subsume policy B given their respective
    origins? </a> <a href="#ref-for-effective-directive-value-4">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="effective-source-list">
   <b><a href="#effective-source-list">#effective-source-list</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-effective-source-list-1">3.1.3. Source List Intersection</a> <a href="#ref-for-effective-source-list-2">(2)</a> <a href="#ref-for-effective-source-list-3">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="abstract-opdef-similarity-of-two-source-expressions">
   <b><a href="#abstract-opdef-similarity-of-two-source-expressions">#abstract-opdef-similarity-of-two-source-expressions</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-abstract-opdef-similarity-of-two-source-expressions-1">3.1.4.3. Source Expression Similarity</a> <a href="#ref-for-abstract-opdef-similarity-of-two-source-expressions-2">(2)</a> <a href="#ref-for-abstract-opdef-similarity-of-two-source-expressions-3">(3)</a> <a href="#ref-for-abstract-opdef-similarity-of-two-source-expressions-4">(4)</a>
    <li><a href="#ref-for-abstract-opdef-similarity-of-two-source-expressions-5">4.2.1. 
    What is an intersection of two expressions matching 
    scheme-source or host-source 
    grammar A and B? </a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="source-expression-wildcard-host">
   <b><a href="#source-expression-wildcard-host">#source-expression-wildcard-host</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-source-expression-wildcard-host-1">3.1.4.3. Source Expression Similarity</a> <a href="#ref-for-source-expression-wildcard-host-2">(2)</a> <a href="#ref-for-source-expression-wildcard-host-3">(3)</a>
    <li><a href="#ref-for-source-expression-wildcard-host-4">4.2.1. 
    What is an intersection of two expressions matching 
    scheme-source or host-source 
    grammar A and B? </a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="source-expression-wildcard-port">
   <b><a href="#source-expression-wildcard-port">#source-expression-wildcard-port</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-source-expression-wildcard-port-1">3.1.4.3. Source Expression Similarity</a>
    <li><a href="#ref-for-source-expression-wildcard-port-2">4.2.1. 
    What is an intersection of two expressions matching 
    scheme-source or host-source 
    grammar A and B? </a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="source-expression-intersection">
   <b><a href="#source-expression-intersection">#source-expression-intersection</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-source-expression-intersection-1">3.1.3. Source List Intersection</a>
    <li><a href="#ref-for-source-expression-intersection-2">4.2.1. 
    What is an intersection of two expressions matching 
    scheme-source or host-source 
    grammar A and B? </a> <a href="#ref-for-source-expression-intersection-3">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="directive-contains">
   <b><a href="#directive-contains">#directive-contains</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-directive-contains-1">4.2.4. 
    Does source list A subsume source listB given their
    respective origins and directive names? </a> <a href="#ref-for-directive-contains-2">(2)</a> <a href="#ref-for-directive-contains-3">(3)</a>
   </ul>
  </aside>
<script>/* script-dfn-panel */

        document.body.addEventListener("click", function(e) {
            var queryAll = function(sel) { return [].slice.call(document.querySelectorAll(sel)); }
            // Find the dfn element or panel, if any, that was clicked on.
            var el = e.target;
            var target;
            var hitALink = false;
            while(el.parentElement) {
                if(el.tagName == "A") {
                    // Clicking on a link in a <dfn> shouldn't summon the panel
                    hitALink = true;
                }
                if(el.classList.contains("dfn-paneled")) {
                    target = "dfn";
                    break;
                }
                if(el.classList.contains("dfn-panel")) {
                    target = "dfn-panel";
                    break;
                }
                el = el.parentElement;
            }
            if(target != "dfn-panel") {
                // Turn off any currently "on" or "activated" panels.
                queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(function(el){
                    el.classList.remove("on");
                    el.classList.remove("activated");
                });
            }
            if(target == "dfn" && !hitALink) {
                // open the panel
                var dfnPanel = document.querySelector(".dfn-panel[data-for='" + el.id + "']");
                if(dfnPanel) {
                    console.log(dfnPanel);
                    dfnPanel.classList.add("on");
                    var rect = el.getBoundingClientRect();
                    dfnPanel.style.left = window.scrollX + rect.right + 5 + "px";
                    dfnPanel.style.top = window.scrollY + rect.top + "px";
                    var panelRect = dfnPanel.getBoundingClientRect();
                    var panelWidth = panelRect.right - panelRect.left;
                    if(panelRect.right > document.body.scrollWidth && (rect.left - (panelWidth + 5)) > 0) {
                        // Reposition, because the panel is overflowing
                        dfnPanel.style.left = window.scrollX + rect.left - (panelWidth + 5) + "px";
                    }
                } else {
                    console.log("Couldn't find .dfn-panel[data-for='" + el.id + "']");
                }
            } else if(target == "dfn-panel") {
                // Switch it to "activated" state, which pins it.
                el.classList.add("activated");
                el.style.left = null;
                el.style.top = null;
            }

        });
        </script>